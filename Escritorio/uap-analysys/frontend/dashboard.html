<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - UAP Analysis System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --dark-gradient: linear-gradient(135deg, #434343 0%, #000000 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0icGFwZXIiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cmVjdCBmaWxsPSIjZjlmOGYzIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIvPjxsaW5lIHgxPSIyMCIgeTE9IjAiIHgyPSIyMCIgeTI9IjIwMCIgc3Ryb2tlPSIjZTBlMGQwIiBzdHJva2Utd2lkdGg9IjAuNSIvPjxsaW5lIHgxPSIwIiB5MT0iNDAiIHgyPSIyMDAiIHkyPSI0MCIgc3Ryb2tlPSIjZDBkMGMwIiBzdHJva2Utd2lkdGg9IjEiLz48bGluZSB4MT0iMCIgeTE9IjgwIiB4Mj0iMjAwIiB5Mj0iODAiIHN0cm9rZT0iI2QwZDBjMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PGxpbmUgeDE9IjAiIHkxPSIxMjAiIHgyPSIyMDAiIHkyPSIxMjAiIHN0cm9rZT0iI2QwZDBjMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PGxpbmUgeDE9IjAiIHkxPSIxNjAiIHgyPSIyMDAiIHkyPSIxNjAiIHN0cm9rZT0iI2QwZDBjMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCBmaWxsPSJ1cmwoI3BhcGVyKSIgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiLz48L3N2Zz4=');
            background-color: #f9f8f3;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            position: relative;
        }

        /* Efecto de documento antiguo con manchas */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(139, 90, 43, 0.08) 0%, transparent 30%),
                radial-gradient(circle at 85% 15%, rgba(139, 90, 43, 0.06) 0%, transparent 25%),
                radial-gradient(circle at 50% 90%, rgba(139, 90, 43, 0.05) 0%, transparent 35%),
                radial-gradient(circle at 95% 80%, rgba(139, 90, 43, 0.07) 0%, transparent 20%);
            pointer-events: none;
            z-index: 0;
        }

        /* Decoraciones: Grabadora vintage */
        body::after {
            content: '';
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 120px;
            height: 80px;
            background: 
                linear-gradient(135deg, #4a4a4a 0%, #2d2d2d 100%);
            border-radius: 8px;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.3),
                inset 0 2px 5px rgba(255,255,255,0.1);
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }

        /* Documentos apilados decorativos */
        .decorative-documents {
            position: fixed;
            bottom: 60px;
            left: 40px;
            width: 100px;
            height: 120px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.12;
        }

        .decorative-documents::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 110px;
            background: white;
            border: 2px solid #8b5a2b;
            border-radius: 3px;
            transform: rotate(-5deg);
            box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
        }

        .decorative-documents::after {
            content: '';
            position: absolute;
            width: 90px;
            height: 110px;
            background: #f9f9f9;
            border: 2px solid #8b5a2b;
            border-radius: 3px;
            transform: rotate(3deg);
            left: 8px;
            top: 5px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
        }

        .navbar {
            background: var(--primary-gradient);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 15px 0;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .sidebar {
            min-height: calc(100vh - 70px);
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-right: 3px solid #8b5a2b;
            padding: 25px 0;
            box-shadow: 5px 0 15px rgba(139, 90, 43, 0.2);
            position: relative;
            z-index: 10;
        }

        /* Efecto de carpeta clasificada en sidebar */
        .sidebar::before {
            content: 'TOP SECRET';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%) rotate(-3deg);
            font-size: 0.7rem;
            font-weight: bold;
            color: #d32f2f;
            border: 2px solid #d32f2f;
            padding: 3px 15px;
            opacity: 0.3;
            letter-spacing: 2px;
        }

        .sidebar .nav-link {
            color: #555;
            padding: 14px 20px;
            margin: 8px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar .nav-link i {
            font-size: 1.2rem;
        }

        .sidebar .nav-link:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .sidebar .nav-link.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(139, 90, 43, 0.15);
            transition: all 0.3s ease;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            position: relative;
            border: 2px solid rgba(139, 90, 43, 0.2);
        }

        /* Sello decorativo en las cards */
        .card::before {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(211, 47, 47, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .stat-card {
            padding: 30px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
        }

        .stat-card:hover::before {
            animation: shine 1.5s ease;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .stat-icon {
            font-size: 48px;
            opacity: 0.85;
            transition: all 0.3s;
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1);
            opacity: 1;
        }

        .welcome-card {
            background: 
                linear-gradient(to bottom, rgba(26, 35, 126, 0.85), rgba(40, 53, 147, 0.9)),
                url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI0MDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJza3kiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMWEyMzdlO3N0b3Atb3BhY2l0eToxIi8+PHN0b3Agb2Zmc2V0PSI1MCUiIHN0eWxlPSJzdG9wLWNvbG9yOiMyODM1OTM7c3RvcC1vcGFjaXR5OjEiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiMzOTQ5YWI7c3RvcC1vcGFjaXR5OjEiLz48L2xpbmVhckdyYWRpZW50PjxyYWRpYWxHcmFkaWVudCBpZD0ibGlnaHQiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmY7c3RvcC1vcGFjaXR5OjAuOCIvPjxzdG9wIG9mZnNldD0iNDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojZmZlZDhhO3N0b3Atb3BhY2l0eTowLjQiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiMxYTIzN2U7c3RvcC1vcGFjaXR5OjAiLz48L3JhZGlhbEdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI0MDAiIGZpbGw9InVybCgjc2t5KSIvPjxlbGxpcHNlIGN4PSI2MDAiIGN5PSIxMjAiIHJ4PSIxODAiIHJ5PSI4MCIgZmlsbD0idXJsKCNsaWdodCkiLz48cG9seWdvbiBwb2ludHM9IjAsMzUwIDIwMCwxODAgNDUwLDI1MCA2MDAsOTAgODAwLDIyMCAxMDAwLDE2MCAxMjAwLDM1MCIgZmlsbD0iIzBhMGYyYSIgb3BhY2l0eT0iMC45Ii8+PHBvbHlnb24gcG9pbnRzPSIxMDAsMzUwIDM1MCwxNjAgNjAwLDkwIDg1MCwxODAgMTEwMCwyNTAgMTIwMCwzNTAiIGZpbGw9IiMwMzA4MWUiIG9wYWNpdHk9IjAuOCIvPjxwb2x5Z29uIHBvaW50cz0iMjAwLDM1MCA1MDAsMjAwIDYwMCw5MCA3NTAsMTQwIDEwMDAsMjgwIDEyMDAsMzUwIiBmaWxsPSIjMDAwMDAwIiBvcGFjaXR5PSIwLjYiLz48L3N2Zz4=');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 40px;
            margin-bottom: 30px;
            border-radius: 20px;
            box-shadow: 
                0 10px 40px rgba(26, 35, 126, 0.4),
                0 0 0 3px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.15);
        }

        .welcome-card::before {
            content: 'CLASSIFIED';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            font-size: 7rem;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.05);
            letter-spacing: 15px;
            pointer-events: none;
            z-index: 0;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .welcome-card > * {
            position: relative;
            z-index: 1;
        }

        .welcome-card h2 {
            font-weight: 900;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 1px;
        }

        .welcome-card h2 {
            font-weight: bold;
            margin-bottom: 15px;
        }

        .badge-role {
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .content-area {
            padding: 35px;
            position: relative;
            z-index: 5;
        }

        /* Efecto de mesa de escritorio con documentos */
        .content-area::before {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 250px;
            background: 
                linear-gradient(180deg, transparent 0%, rgba(101, 67, 33, 0.03) 100%);
            pointer-events: none;
            z-index: 1;
        }

        /* Marca de caf√© decorativa */
        .content-area::after {
            content: '';
            position: fixed;
            top: 200px;
            right: 150px;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(101, 67, 33, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
        }

        .btn {
            border-radius: 10px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: var(--primary-gradient);
            border: none;
        }

        .btn-success {
            background: var(--success-gradient);
            border: none;
        }

        .btn-danger {
            background: var(--secondary-gradient);
            border: none;
        }

        .alert {
            border-radius: 15px;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .progress {
            border-radius: 10px;
            height: 30px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-bar {
            border-radius: 10px;
            background: var(--primary-gradient);
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            padding: 12px 15px;
            transition: all 0.3s;
        }

        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .table {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .table thead {
            background: var(--primary-gradient);
            color: white;
        }

        .table tbody tr {
            transition: all 0.3s;
        }

        .table tbody tr:hover {
            background-color: #f8f9fa;
            transform: scale(1.01);
        }

        /* Animaciones personalizadas */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: fadeIn 0.5s ease;
        }

        /* Estilos para el bot√≥n de PayPal */
        .paypal-button {
            background: linear-gradient(135deg, #0070ba 0%, #1546a0 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 20px rgba(0, 112, 186, 0.4);
            transition: all 0.3s ease;
        }

        .paypal-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 112, 186, 0.6);
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        /* Micr√≥fono vintage decorativo */
        .vintage-microphone {
            position: fixed;
            top: 120px;
            right: 50px;
            width: 40px;
            height: 80px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.1;
        }

        .vintage-microphone::before {
            content: '';
            position: absolute;
            width: 35px;
            height: 50px;
            background: linear-gradient(180deg, #5a5a5a 0%, #3a3a3a 100%);
            border-radius: 15px 15px 5px 5px;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .vintage-microphone::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 30px;
            background: #4a4a4a;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        /* C√°mara antigua */
        .old-camera {
            position: fixed;
            top: 150px;
            left: 50px;
            width: 70px;
            height: 50px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.1;
        }

        .old-camera::before {
            content: '';
            position: absolute;
            width: 60px;
            height: 45px;
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .old-camera::after {
            content: '';
            position: absolute;
            width: 25px;
            height: 25px;
            background: radial-gradient(circle, #666 0%, #333 100%);
            border-radius: 50%;
            top: 10px;
            right: 15px;
            border: 3px solid #444;
        }

        /* Teclas de m√°quina de escribir */
        .typewriter-keys {
            position: fixed;
            bottom: 180px;
            right: 60px;
            width: 80px;
            height: 60px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.08;
        }

        .typewriter-keys::before,
        .typewriter-keys::after {
            content: '';
            width: 15px;
            height: 15px;
            background: linear-gradient(135deg, #f5f5f5 0%, #d0d0d0 100%);
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Clips y chinchetas decorativas */
        .sidebar::after {
            content: 'üìé';
            position: absolute;
            top: 80px;
            right: 15px;
            font-size: 30px;
            opacity: 0.15;
            transform: rotate(45deg);
        }

        /* Sello "CONFIDENCIAL" en cards */
        .stat-card::after {
            content: 'CONFIDENCIAL';
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-size: 0.5rem;
            color: rgba(211, 47, 47, 0.15);
            font-weight: bold;
            letter-spacing: 1px;
            transform: rotate(-10deg);
            border: 1px solid rgba(211, 47, 47, 0.15);
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .content-area {
                padding: 20px;
            }
            
            .welcome-card {
                padding: 25px;
            }
            
            .stat-card {
                padding: 20px;
            }

            .vintage-microphone,
            .old-camera,
            .typewriter-keys,
            .decorative-documents {
                display: none;
            }

            .ufo-animated {
                display: none;
            }
        }

        /* Logo UFO realista en navbar */
        .navbar-brand i.bi-disc {
            display: inline-block;
            position: relative;
            font-size: 1.8rem;
            background: linear-gradient(135deg, #e0e0e0 0%, #757575 50%, #424242 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
            animation: glow-logo 3s ease-in-out infinite;
        }

        @keyframes glow-logo {
            0%, 100% { 
                filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
            }
            50% { 
                filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.9)) drop-shadow(0 0 25px rgba(100, 200, 255, 0.5));
            }
        }

        /* Platillo volante animado en el fondo */
        .ufo-animated {
            position: fixed;
            width: 180px;
            height: 80px;
            top: 20%;
            left: -200px;
            z-index: 1;
            pointer-events: none;
            animation: flyUFO 25s linear infinite;
        }

        @keyframes flyUFO {
            0% {
                left: -200px;
                top: 20%;
                transform: rotate(-5deg);
            }
            25% {
                left: 30%;
                top: 15%;
                transform: rotate(3deg);
            }
            50% {
                left: 60%;
                top: 25%;
                transform: rotate(-2deg);
            }
            75% {
                left: 85%;
                top: 18%;
                transform: rotate(5deg);
            }
            100% {
                left: 120%;
                top: 22%;
                transform: rotate(-5deg);
            }
        }

        /* Estructura del platillo realista */
        .ufo-body {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* Domo superior del UFO */
        .ufo-dome {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 30px;
            background: radial-gradient(ellipse at 50% 30%, rgba(150, 200, 255, 0.9), rgba(80, 150, 255, 0.7));
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            box-shadow: 
                inset 0 -3px 8px rgba(255, 255, 255, 0.5),
                0 2px 10px rgba(100, 150, 255, 0.6);
            animation: ufo-pulse 2s ease-in-out infinite;
        }

        /* Cuerpo principal met√°lico */
        .ufo-disc {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 40px;
            background: linear-gradient(to bottom, 
                #e8e8e8 0%, 
                #c0c0c0 20%,
                #a0a0a0 40%,
                #888888 60%,
                #707070 80%,
                #585858 100%);
            border-radius: 50%;
            box-shadow: 
                0 5px 20px rgba(0, 0, 0, 0.5),
                inset 0 2px 10px rgba(255, 255, 255, 0.4),
                inset 0 -2px 8px rgba(0, 0, 0, 0.3);
            animation: ufo-rotate 4s linear infinite;
        }

        /* Luces del UFO */
        .ufo-lights {
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            width: 160px;
            height: 10px;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .ufo-light {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: ufo-light-blink 1s ease-in-out infinite;
        }

        .ufo-light:nth-child(1) {
            background: radial-gradient(circle, #ff4444, #cc0000);
            box-shadow: 0 0 10px #ff4444, 0 0 20px #ff0000;
            animation-delay: 0s;
        }

        .ufo-light:nth-child(2) {
            background: radial-gradient(circle, #44ff44, #00cc00);
            box-shadow: 0 0 10px #44ff44, 0 0 20px #00ff00;
            animation-delay: 0.33s;
        }

        .ufo-light:nth-child(3) {
            background: radial-gradient(circle, #4444ff, #0000cc);
            box-shadow: 0 0 10px #4444ff, 0 0 20px #0000ff;
            animation-delay: 0.66s;
        }

        .ufo-light:nth-child(4) {
            background: radial-gradient(circle, #ffff44, #cccc00);
            box-shadow: 0 0 10px #ffff44, 0 0 20px #ffff00;
            animation-delay: 1s;
        }

        .ufo-light:nth-child(5) {
            background: radial-gradient(circle, #ff44ff, #cc00cc);
            box-shadow: 0 0 10px #ff44ff, 0 0 20px #ff00ff;
            animation-delay: 1.33s;
        }

        @keyframes ufo-pulse {
            0%, 100% { 
                transform: translateX(-50%) scale(1);
                opacity: 0.9;
            }
            50% { 
                transform: translateX(-50%) scale(1.05);
                opacity: 1;
            }
        }

        @keyframes ufo-rotate {
            0%, 100% { 
                box-shadow: 
                    0 5px 20px rgba(0, 0, 0, 0.5),
                    inset 0 2px 10px rgba(255, 255, 255, 0.4),
                    inset 0 -2px 8px rgba(0, 0, 0, 0.3);
            }
            50% { 
                box-shadow: 
                    0 5px 25px rgba(0, 0, 0, 0.6),
                    inset 0 2px 12px rgba(255, 255, 255, 0.5),
                    inset 0 -2px 10px rgba(0, 0, 0, 0.4);
            }
        }

        @keyframes ufo-light-blink {
            0%, 100% { 
                opacity: 0.3;
                transform: scale(0.8);
            }
            50% { 
                opacity: 1;
                transform: scale(1.2);
            }
        }
    </style>
</head>
<body>
    <!-- Platillo volante animado en el fondo -->
    <div class="ufo-animated">
        <div class="ufo-body">
            <div class="ufo-dome"></div>
            <div class="ufo-disc"></div>
            <div class="ufo-lights">
                <div class="ufo-light"></div>
                <div class="ufo-light"></div>
                <div class="ufo-light"></div>
                <div class="ufo-light"></div>
                <div class="ufo-light"></div>
            </div>
        </div>
    </div>

    <!-- Elementos decorativos -->
    <div class="decorative-documents"></div>
    <div class="vintage-microphone"></div>
    <div class="old-camera"></div>
    <div class="typewriter-keys"></div>

    <!-- Navbar -->
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-disc"></i> UAP Analysis System
            </a>
            <div class="d-flex align-items-center gap-3">
                <!-- Badge de notificaciones -->
                <a href="notifications.html" class="position-relative text-white text-decoration-none" title="Notificaciones">
                    <i class="bi bi-bell-fill" style="font-size: 1.5rem;"></i>
                    <span id="notificationBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                        0
                    </span>
                </a>
                
                <span class="text-white">
                    <i class="bi bi-person-circle"></i> 
                    <span id="userName">Usuario</span>
                </span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">
                    <i class="bi bi-box-arrow-right"></i> Salir
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('profile')">
                        <i class="bi bi-person"></i> Mi Perfil
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('uploads')">
                        <i class="bi bi-cloud-upload"></i> Subir An√°lisis
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('reports')">
                        <i class="bi bi-file-earmark-text"></i> Mis Reportes
                    </a>
                    <!-- ADMIN ONLY: Training Data Entry -->
                    <a class="nav-link admin-only" href="#" onclick="showSection('training')" style="display: none;">
                        <i class="bi bi-database-fill-add"></i> Admin - Entrada de Datos
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('donate')">
                        <i class="bi bi-heart-fill"></i> Donar
                    </a>
                    <a class="nav-link" href="https://www.ovniesp.com" target="_blank" rel="noopener">
                        <i class="bi bi-globe"></i> Nuestra Web
                    </a>
                    <a class="nav-link" href="index.html">
                        <i class="bi bi-house"></i> Inicio
                    </a>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 content-area">
                <!-- Welcome Card -->
                <div class="card welcome-card">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2>¬°Bienvenido <span id="userFirstName">Usuario</span>!</h2>
                            <p class="mb-2">
                                <i class="bi bi-envelope"></i> 
                                <span id="userEmail">email@ejemplo.com</span>
                            </p>
                            <span class="badge-role bg-light text-dark" id="userRole">Usuario</span>
                        </div>
                        <div class="col-md-4 text-end">
                            <i class="bi bi-person-circle" style="font-size: 80px;"></i>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Section -->
                <div id="dashboardSection">
                    <h3 class="mb-4">Panel de Control</h3>
                    
                    <div class="row">
                        <div class="col-md-3 mb-4">
                            <div class="card stat-card">
                                <div class="text-center">
                                    <i class="bi bi-cloud-upload stat-icon text-primary"></i>
                                    <h3 class="mt-3">0</h3>
                                    <p class="text-muted">An√°lisis Subidos</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 mb-4">
                            <div class="card stat-card">
                                <div class="text-center">
                                    <i class="bi bi-file-earmark-check stat-icon text-success"></i>
                                    <h3 class="mt-3">0</h3>
                                    <p class="text-muted">Reportes Generados</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 mb-4">
                            <div class="card stat-card">
                                <div class="text-center">
                                    <i class="bi bi-hourglass-split stat-icon text-warning"></i>
                                    <h3 class="mt-3">0</h3>
                                    <p class="text-muted">En Proceso</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card p-4">
                                <h5><i class="bi bi-info-circle"></i> Funcionalidades del Sistema</h5>
                                <ul class="mt-3">
                                    <li>‚úÖ Subir im√°genes y videos de avistamientos UAP</li>
                                    <li>‚úÖ An√°lisis con IA (Llama Vision) para identificar objetos</li>
                                    <li>‚úÖ Extracci√≥n de datos EXIF de las im√°genes</li>
                                    <li>‚úÖ Detecci√≥n de manipulaci√≥n de im√°genes</li>
                                    <li>üìÑ Generaci√≥n de reportes PDF profesionales (pr√≥ximamente)</li>
                                    <li>üìß Env√≠o de reportes por email (pr√≥ximamente)</li>
                                </ul>
                                <div class="alert alert-info mt-3">
                                    <i class="bi bi-heart-fill"></i> <strong>Este proyecto es 100% gratuito y open-source.</strong> 
                                    Si te gusta, considera hacer una donaci√≥n para apoyar el desarrollo.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Section (Hidden by default) -->
                <div id="profileSection" style="display: none;">
                    <h3 class="mb-4">Mi Perfil</h3>
                    <div class="card p-4">
                        <div id="profileAlertContainer"></div>
                        
                        <form id="profileForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="profileFirstName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Apellido</label>
                                    <input type="text" class="form-control" id="profileLastName" required>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Username</label>
                                    <input type="text" class="form-control" id="profileUsername" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="profileEmail" required>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Tel√©fono</label>
                                    <input type="tel" class="form-control" id="profilePhone">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Pa√≠s</label>
                                    <input type="text" class="form-control" id="profileCountry">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Biograf√≠a</label>
                                <textarea class="form-control" id="profileBio" rows="3"></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Guardar Cambios
                            </button>
                        </form>

                        <hr class="my-4">

                        <h5>Cambiar Contrase√±a</h5>
                        <form id="changePasswordForm" class="mt-3">
                            <div class="mb-3">
                                <label class="form-label">Contrase√±a Actual</label>
                                <input type="password" class="form-control" id="currentPassword" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nueva Contrase√±a</label>
                                <input type="password" class="form-control" id="newPassword" required minlength="6">
                            </div>
                            <button type="submit" class="btn btn-warning">
                                <i class="bi bi-key"></i> Cambiar Contrase√±a
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Other sections placeholders -->
                <div id="uploadsSection" style="display: none;">
                    <h3 class="mb-4">Subir An√°lisis</h3>
                    
                    <div class="card p-4 mb-4">
                        <h5><i class="bi bi-cloud-upload"></i> Subir Imagen o Video</h5>
                        <p class="text-muted">Sube una foto o video de tu avistamiento UAP para analizarlo.</p>
                        
                        <div id="uploadAlertContainer"></div>
                        
                        <form id="uploadForm">
                            <!-- Paso 1: Archivo -->
                            <div class="mb-4">
                                <h5><i class="bi bi-1-circle"></i> Seleccionar Archivo</h5>
                                <div class="mb-3">
                                    <label class="form-label">Imagen o video del avistamiento</label>
                                    <input 
                                        type="file" 
                                        class="form-control" 
                                        id="fileInput" 
                                        accept="image/*,video/*"
                                        required
                                    >
                                    <small class="text-muted">
                                        Formatos: JPG, PNG, GIF, WEBP, MP4, MOV, AVI, WEBM | M√°ximo: 50MB
                                    </small>
                                </div>
                                
                                <!-- Preview -->
                                <div id="previewContainer" style="display: none;" class="mb-3">
                                    <label class="form-label">Vista previa:</label>
                                    <div id="previewContent"></div>
                                </div>
                            </div>

                            <!-- Paso 2: Contexto del Avistamiento -->
                            <div class="mb-4 border-top pt-4">
                                <h5><i class="bi bi-2-circle"></i> Informaci√≥n del Avistamiento</h5>
                                <p class="text-muted small">Esta informaci√≥n mejora significativamente la precisi√≥n del an√°lisis.</p>

                                <div class="row">
                                    <!-- Movimiento -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Tipo de movimiento observado</label>
                                        <select class="form-select" id="contextMovement">
                                            <option value="no observado">No observado / No recuerdo</option>
                                            <option value="est√°tico">Est√°tico (sin movimiento)</option>
                                            <option value="lento">Lento y constante</option>
                                            <option value="moderado">Moderado</option>
                                            <option value="r√°pido">R√°pido</option>
                                            <option value="muy r√°pido">Muy r√°pido</option>
                                            <option value="err√°tico">Err√°tico (impredecible)</option>
                                            <option value="zigzag">Zigzag</option>
                                            <option value="circular">Circular</option>
                                        </select>
                                    </div>

                                    <!-- Velocidad -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Velocidad estimada (1-5)</label>
                                        <input type="range" class="form-range" id="contextSpeed" min="1" max="5" value="3">
                                        <div class="d-flex justify-content-between">
                                            <small>Muy lento</small>
                                            <small id="speedValue">Normal</small>
                                            <small>Muy r√°pido</small>
                                        </div>
                                    </div>

                                    <!-- Altura -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Altura estimada</label>
                                        <select class="form-select" id="contextAltitude">
                                            <option value="no determinada">No determinada</option>
                                            <option value="muy baja">Muy baja (< 100m)</option>
                                            <option value="baja">Baja (100-500m)</option>
                                            <option value="media">Media (500-3000m)</option>
                                            <option value="alta">Alta (3000-10000m)</option>
                                            <option value="muy alta">Muy alta (> 10000m)</option>
                                        </select>
                                    </div>

                                    <!-- Color de luz -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Color(es) de luz observado(s)</label>
                                        <select class="form-select" id="contextLightColor" multiple size="3">
                                            <option value="sin luz visible" selected>Sin luz visible</option>
                                            <option value="blanco">Blanco</option>
                                            <option value="amarillo">Amarillo</option>
                                            <option value="naranja">Naranja</option>
                                            <option value="rojo">Rojo</option>
                                            <option value="verde">Verde</option>
                                            <option value="azul">Azul</option>
                                            <option value="p√∫rpura">P√∫rpura</option>
                                            <option value="multicolor">Multicolor</option>
                                        </select>
                                        <small class="text-muted">Mant√©n Ctrl para seleccionar m√∫ltiples</small>
                                    </div>

                                    <!-- Intensidad luz -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Intensidad de la luz</label>
                                        <select class="form-select" id="contextLightIntensity">
                                            <option value="sin luz">Sin luz</option>
                                            <option value="tenue">Tenue</option>
                                            <option value="media" selected>Media</option>
                                            <option value="brillante">Brillante</option>
                                            <option value="muy brillante">Muy brillante</option>
                                            <option value="cegadora">Cegadora</option>
                                            <option value="parpadeante">Parpadeante</option>
                                            <option value="intermitente">Intermitente</option>
                                        </select>
                                    </div>

                                    <!-- Sonido -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Sonido escuchado</label>
                                        <select class="form-select" id="contextSound">
                                            <option value="sin sonido" selected>Sin sonido</option>
                                            <option value="zumbido">Zumbido</option>
                                            <option value="silbido">Silbido</option>
                                            <option value="motor">Motor</option>
                                            <option value="explosi√≥n">Explosi√≥n</option>
                                            <option value="otro">Otro (especificar abajo)</option>
                                        </select>
                                    </div>

                                    <!-- Duraci√≥n -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Duraci√≥n del avistamiento</label>
                                        <input type="text" class="form-control" id="contextDuration" placeholder="Ej: 30 segundos, 5 minutos">
                                    </div>

                                    <!-- Clima -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Condiciones clim√°ticas</label>
                                        <select class="form-select" id="contextWeather">
                                            <option value="no recuerdo">No recuerdo</option>
                                            <option value="despejado" selected>Despejado</option>
                                            <option value="parcialmente nublado">Parcialmente nublado</option>
                                            <option value="nublado">Nublado</option>
                                            <option value="lluvia">Lluvia</option>
                                            <option value="tormenta">Tormenta</option>
                                            <option value="niebla">Niebla</option>
                                        </select>
                                    </div>

                                    <!-- Actividad testigo -->
                                    <div class="col-md-12 mb-3">
                                        <label class="form-label">¬øQu√© estaba haciendo en el momento del avistamiento?</label>
                                        <input type="text" class="form-control" id="contextActivity" placeholder="Ej: caminando, conduciendo, observando el cielo...">
                                    </div>
                                </div>
                            </div>

                            <!-- Paso 3: Contexto Personal -->
                            <div class="mb-4 border-top pt-4">
                                <h5><i class="bi bi-3-circle"></i> Contexto Personal (Opcional pero Importante)</h5>
                                <p class="text-muted small">Esta informaci√≥n ayuda a evaluar la credibilidad y contexto del testimonio.</p>

                                <div class="row">
                                    <!-- Consumo sustancias -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">¬øHab√≠a consumido alcohol o sustancias?</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="substanceUse" id="substanceNo" value="false" checked>
                                            <label class="form-check-label" for="substanceNo">No</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="substanceUse" id="substanceYes" value="true">
                                            <label class="form-check-label" for="substanceYes">S√≠</label>
                                        </div>
                                    </div>

                                    <!-- Creencias -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Su nivel de creencia en OVNIs</label>
                                        <select class="form-select" id="contextBelief">
                                            <option value="muy esc√©ptico">Muy esc√©ptico</option>
                                            <option value="esc√©ptico">Esc√©ptico</option>
                                            <option value="neutral" selected>Neutral</option>
                                            <option value="creyente">Creyente</option>
                                            <option value="muy creyente">Muy creyente</option>
                                        </select>
                                    </div>

                                    <!-- Acompa√±ado -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">¬øEstaba acompa√±ado?</label>
                                        <select class="form-select" id="contextAccompanied" onchange="toggleWitnessCount()">
                                            <option value="false" selected>Solo</option>
                                            <option value="true">Acompa√±ado</option>
                                        </select>
                                        <input type="number" class="form-control mt-2" id="contextWitnessCount" min="1" max="100" value="1" placeholder="N√∫mero de testigos" style="display: none;">
                                    </div>

                                    <!-- Estado emocional -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Estado emocional durante el avistamiento</label>
                                        <select class="form-select" id="contextEmotional">
                                            <option value="calmado">Calmado</option>
                                            <option value="curioso" selected>Curioso</option>
                                            <option value="asustado">Asustado</option>
                                            <option value="emocionado">Emocionado</option>
                                            <option value="confundido">Confundido</option>
                                            <option value="otro">Otro</option>
                                        </select>
                                    </div>

                                    <!-- Avistamientos previos -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">¬øHa tenido avistamientos previos?</label>
                                        <select class="form-select" id="contextPreviousSightings" onchange="togglePreviousCount()">
                                            <option value="false" selected>No</option>
                                            <option value="true">S√≠</option>
                                        </select>
                                        <input type="number" class="form-control mt-2" id="contextPreviousCount" min="1" max="100" placeholder="N√∫mero de avistamientos previos" style="display: none;">
                                    </div>

                                    <!-- Descripci√≥n del incidente -->
                                    <div class="col-md-12 mb-3">
                                        <label class="form-label">Descripci√≥n detallada del suceso</label>
                                        <textarea class="form-control" id="contextDescription" rows="4" placeholder="Describa con el mayor detalle posible lo que vio, sinti√≥ y experiment√≥ durante el avistamiento..."></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Barra de progreso -->
                            <div id="progressContainer" style="display: none;" class="mb-3">
                                <div class="progress">
                                    <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                         role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="progressText" class="text-muted"></small>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-lg" id="uploadBtn">
                                <i class="bi bi-cloud-upload"></i> Subir y Analizar
                            </button>
                            <small class="text-muted d-block mt-2">
                                <i class="bi bi-info-circle"></i> El an√°lisis comenzar√° autom√°ticamente tras la subida
                            </small>
                        </form>
                    </div>
                    
                    <!-- Lista de uploads -->
                    <div class="card p-4">
                        <h5><i class="bi bi-list"></i> Mis Uploads</h5>
                        <div id="uploadsListContainer">
                            <div class="text-center text-muted">
                                <i class="bi bi-hourglass-split"></i> Cargando...
                            </div>
                        </div>
                    </div>
                </div>

                <div id="reportsSection" style="display: none;">
                    <h3 class="mb-4"><i class="bi bi-file-earmark-text"></i> Mis Reportes</h3>
                    
                    <!-- Filtros -->
                    <div class="card p-3 mb-4">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label small">Filtrar por categor√≠a</label>
                                <select class="form-select form-select-sm" id="filterCategory">
                                    <option value="">Todas las categor√≠as</option>
                                    <option value="celestial">Celestial</option>
                                    <option value="aircraft">Aeronave</option>
                                    <option value="satellite">Sat√©lite</option>
                                    <option value="drone">Drone</option>
                                    <option value="balloon">Globo</option>
                                    <option value="bird">Ave</option>
                                    <option value="natural">Natural</option>
                                    <option value="uap">UAP</option>
                                    <option value="unknown">Desconocido</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Filtrar por estado</label>
                                <select class="form-select form-select-sm" id="filterStatus">
                                    <option value="">Todos los estados</option>
                                    <option value="completed">Completado</option>
                                    <option value="analyzing">Analizando</option>
                                    <option value="pending">Pendiente</option>
                                    <option value="error">Error</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Buscar</label>
                                <input type="text" class="form-control form-control-sm" id="searchReports" placeholder="Buscar por nombre...">
                            </div>
                        </div>
                        <div class="mt-3 text-end">
                            <button class="btn btn-sm btn-primary" onclick="loadReports()">
                                <i class="bi bi-funnel"></i> Aplicar Filtros
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="clearFilters()">
                                <i class="bi bi-x-circle"></i> Limpiar
                            </button>
                        </div>
                    </div>

                    <!-- Estad√≠sticas R√°pidas -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card text-center p-3">
                                <h4 class="mb-0" id="totalReports">0</h4>
                                <small class="text-muted">Total An√°lisis</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center p-3">
                                <h4 class="mb-0" id="completedReports">0</h4>
                                <small class="text-muted">Completados</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center p-3">
                                <h4 class="mb-0" id="uapReports">0</h4>
                                <small class="text-muted">UAP Detectados</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center p-3">
                                <h4 class="mb-0" id="avgConfidence">0%</h4>
                                <small class="text-muted">Confianza Promedio</small>
                            </div>
                        </div>
                    </div>

                    <!-- Lista de Reportes -->
                    <div class="card p-4">
                        <div id="reportsListContainer">
                            <div class="text-center text-muted">
                                <i class="bi bi-hourglass-split"></i> Cargando reportes...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Training Data Section (ADMIN ONLY) -->
                <div id="trainingSection" style="display: none;" class="admin-only">
                    <h3 class="mb-4">
                        <i class="bi bi-database-fill-add text-primary"></i> 
                        Administrador - Entrada de Datos de Entrenamiento
                    </h3>

                    <!-- Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card text-center p-3">
                                <i class="bi bi-images text-primary" style="font-size: 2rem;"></i>
                                <h4 id="trainingStatsTotal" class="mt-2">-</h4>
                                <p class="text-muted mb-0">Total Im√°genes</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center p-3">
                                <i class="bi bi-check-circle text-success" style="font-size: 2rem;"></i>
                                <h4 id="trainingStatsVerified" class="mt-2">-</h4>
                                <p class="text-muted mb-0">Verificadas</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center p-3">
                                <i class="bi bi-tags text-info" style="font-size: 2rem;"></i>
                                <h4 id="trainingStatsCategories" class="mt-2">-</h4>
                                <p class="text-muted mb-0">Categor√≠as</p>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Form -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="bi bi-cloud-upload"></i> Subir Nueva Imagen de Entrenamiento</h5>
                        </div>
                        <div class="card-body">
                            <form id="trainingUploadForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Imagen *</label>
                                        <input type="file" class="form-control" id="trainingImage" accept="image/*" required>
                                        <div class="form-text">JPG, PNG o WEBP. M√°x. 10MB</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Categor√≠a *</label>
                                        <select class="form-select" id="trainingCategory" required>
                                            <option value="">Seleccione...</option>
                                            <option value="aircraft_commercial">Avi√≥n Comercial</option>
                                            <option value="aircraft_military">Avi√≥n Militar</option>
                                            <option value="drone">Drone</option>
                                            <option value="helicopter">Helic√≥ptero</option>
                                            <option value="balloon">Globo/Dirigible</option>
                                            <option value="satellite">Sat√©lite</option>
                                            <option value="bird">Ave</option>
                                            <option value="natural">Fen√≥meno Natural</option>
                                            <option value="celestial">Objeto Celeste</option>
                                            <option value="lens_flare">Destello de Lente</option>
                                            <option value="weather">Fen√≥meno Meteorol√≥gico</option>
                                            <option value="unknown">Desconocido</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Tipo / Modelo *</label>
                                    <input type="text" class="form-control" id="trainingType" 
                                           placeholder="Ej: Boeing 737-800, DJI Phantom 4, ISS" required>
                                    <div class="form-text">Especifica el modelo o tipo espec√≠fico del objeto</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Descripci√≥n</label>
                                    <textarea class="form-control" id="trainingDescription" rows="3" 
                                              placeholder="Contexto adicional, caracter√≠sticas visuales, condiciones de captura..."></textarea>
                                </div>

                                <!-- Preview -->
                                <div id="trainingPreview" class="mb-3" style="display: none;">
                                    <label class="form-label">Vista Previa:</label>
                                    <img id="trainingPreviewImg" class="img-thumbnail" style="max-width: 300px; max-height: 300px;">
                                </div>

                                <div id="trainingUploadMsg" class="mb-3"></div>

                                <div class="text-end">
                                    <button type="reset" class="btn btn-secondary">
                                        <i class="bi bi-x-circle"></i> Limpiar
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-upload"></i> Subir Imagen
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Images List -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="bi bi-list-ul"></i> Im√°genes de Entrenamiento</h5>
                            <button class="btn btn-sm btn-outline-primary" onclick="loadTrainingImages()">
                                <i class="bi bi-arrow-clockwise"></i> Actualizar
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- Filters -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <select class="form-select form-select-sm" id="trainingFilterCategory" onchange="loadTrainingImages()">
                                        <option value="">Todas las categor√≠as</option>
                                        <option value="aircraft_commercial">Avi√≥n Comercial</option>
                                        <option value="aircraft_military">Avi√≥n Militar</option>
                                        <option value="drone">Drone</option>
                                        <option value="helicopter">Helic√≥ptero</option>
                                        <option value="balloon">Globo/Dirigible</option>
                                        <option value="satellite">Sat√©lite</option>
                                        <option value="bird">Ave</option>
                                        <option value="natural">Fen√≥meno Natural</option>
                                        <option value="celestial">Objeto Celeste</option>
                                        <option value="lens_flare">Destello de Lente</option>
                                        <option value="weather">Fen√≥meno Meteorol√≥gico</option>
                                        <option value="unknown">Desconocido</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select form-select-sm" id="trainingFilterVerified" onchange="loadTrainingImages()">
                                        <option value="">Todas</option>
                                        <option value="true">Solo Verificadas</option>
                                        <option value="false">No Verificadas</option>
                                    </select>
                                </div>
                            </div>

                            <div id="trainingImagesContainer">
                                <div class="text-center py-4">
                                    <div class="spinner-border" role="status">
                                        <span class="visually-hidden">Cargando...</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Pagination -->
                            <nav id="trainingPagination" class="mt-3"></nav>
                        </div>
                    </div>
                </div>

                <!-- Donate Section -->
                <div id="donateSection" style="display: none;">
                    <h3 class="mb-4"><i class="bi bi-heart-fill text-danger"></i> Apoya el Proyecto</h3>
                    
                    <div class="row">
                        <div class="col-md-8 mx-auto">
                            <div class="card p-4 shadow-sm">
                                <div class="text-center mb-4">
                                    <i class="bi bi-rocket-takeoff" style="font-size: 64px; color: #0d6efd;"></i>
                                    <h4 class="mt-3">UAP Analysis System</h4>
                                    <p class="text-muted">Un proyecto open-source para la investigaci√≥n de fen√≥menos a√©reos no identificados</p>
                                </div>

                                <div class="alert alert-info">
                                    <h5><i class="bi bi-info-circle"></i> ¬øPor qu√© donar?</h5>
                                    <ul class="mb-0">
                                        <li>üöÄ Mantener los servidores y servicios activos</li>
                                        <li>ü§ñ Cubrir costos de APIs de IA (cuando sea necesario)</li>
                                        <li>üíª Desarrollo de nuevas funcionalidades</li>
                                        <li>üìö Documentaci√≥n y soporte a la comunidad</li>
                                        <li>üî¨ Investigaci√≥n y mejora de algoritmos de detecci√≥n</li>
                                    </ul>
                                </div>

                                <div class="text-center my-4">
                                    <h5 class="mb-3">Dona con PayPal</h5>
                                    <p class="text-muted small mb-3">Cualquier cantidad es bienvenida y apreciada</p>
                                    
                                    <!-- Bot√≥n de PayPal -->
                                    <form action="https://www.paypal.com/donate" method="post" target="_blank">
                                        <input type="hidden" name="hosted_button_id" value="ZPJFSZ9S47DJL" />
                                        <button type="submit" class="paypal-button">
                                            <i class="bi bi-paypal"></i> Donar con PayPal
                                        </button>
                                    </form>

                                    <p class="text-muted small mt-3">
                                        <i class="bi bi-shield-check"></i> Pago seguro procesado por PayPal
                                    </p>
                                </div>

                                <hr>

                                <div class="mt-4">
                                    <h5><i class="bi bi-github"></i> Otras formas de contribuir</h5>
                                    <ul>
                                        <li><strong>GitHub:</strong> Contribuye con c√≥digo, reporta bugs o sugiere mejoras</li>
                                        <li><strong>Documentaci√≥n:</strong> Ayuda a mejorar la documentaci√≥n del proyecto</li>
                                        <li><strong>Difusi√≥n:</strong> Comparte el proyecto con otros investigadores</li>
                                        <li><strong>Datos:</strong> Aporta im√°genes de calidad para entrenar modelos</li>
                                    </ul>
                                    
                                    <div class="text-center mt-3">
                                        <a href="https://github.com/ufoteoria-sudo/PROYECT-OVNI-ESP" target="_blank" class="btn btn-dark">
                                            <i class="bi bi-github"></i> Ver en GitHub
                                        </a>
                                    </div>
                                </div>

                                <div class="alert alert-success mt-4">
                                    <strong><i class="bi bi-heart-fill"></i> ¬°Gracias por tu apoyo!</strong><br>
                                    Cada contribuci√≥n nos ayuda a mantener este proyecto abierto y gratuito para todos.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';
        let currentUser = null;

        // Verificar autenticaci√≥n
        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Token inv√°lido');
                }

                const data = await response.json();
                // El backend devuelve { user: {...} }
                currentUser = data.user || data;
                console.log('üîê Usuario cargado desde /me:', currentUser);
                displayUserInfo();
                loadProfileData();

            } catch (error) {
                console.error('Error:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            }
        }

        function displayUserInfo() {
            if (!currentUser) return;

            console.log('üë§ Usuario actual:', currentUser);
            console.log('üîë Rol:', currentUser.role);

            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userFirstName').textContent = currentUser.firstName || currentUser.username;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userRole').textContent = currentUser.role === 'admin' ? 'Administrador' : 'Usuario';
            
            // Mostrar/ocultar elementos de administrador
            const adminElements = document.querySelectorAll('.admin-only');
            console.log('üîç Elementos admin encontrados:', adminElements.length);
            
            if (currentUser.role === 'admin') {
                console.log('‚úÖ Usuario es admin - mostrando elementos');
                adminElements.forEach(el => {
                    console.log('  Mostrando elemento:', el);
                    el.style.removeProperty('display');
                });
            } else {
                console.log('‚ùå Usuario NO es admin - ocultando elementos');
                adminElements.forEach(el => {
                    el.style.display = 'none';
                });
            }
        }

        function loadProfileData() {
            if (!currentUser) return;

            document.getElementById('profileFirstName').value = currentUser.firstName || '';
            document.getElementById('profileLastName').value = currentUser.lastName || '';
            document.getElementById('profileUsername').value = currentUser.username || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
            document.getElementById('profilePhone').value = currentUser.profile?.phone || '';
            document.getElementById('profileCountry').value = currentUser.profile?.country || '';
            document.getElementById('profileBio').value = currentUser.profile?.bio || '';
        }

        function showSection(section) {
            // Ocultar todas las secciones
            document.querySelectorAll('[id$="Section"]').forEach(el => el.style.display = 'none');
            
            // Mostrar la secci√≥n seleccionada
            document.getElementById(section + 'Section').style.display = 'block';

            // Cargar datos espec√≠ficos de la secci√≥n
            if (section === 'training' && currentUser?.role === 'admin') {
                loadTrainingImages();
                loadTrainingStats();
            }

            // Actualizar nav activo
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        // Actualizar perfil
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const token = localStorage.getItem('token');
            const formData = {
                username: document.getElementById('profileUsername').value,
                email: document.getElementById('profileEmail').value,
                firstName: document.getElementById('profileFirstName').value,
                lastName: document.getElementById('profileLastName').value,
                profile: {
                    phone: document.getElementById('profilePhone').value,
                    country: document.getElementById('profileCountry').value,
                    bio: document.getElementById('profileBio').value
                }
            };

            try {
                const response = await fetch(`${API_URL}/api/users/${currentUser.id}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok) {
                    showProfileAlert('Perfil actualizado exitosamente', 'success');
                    currentUser = data;
                    displayUserInfo();
                } else {
                    showProfileAlert(data.error || 'Error al actualizar perfil', 'danger');
                }
            } catch (error) {
                showProfileAlert('Error de conexi√≥n', 'danger');
            }
        });

        // Cambiar contrase√±a
        document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const token = localStorage.getItem('token');
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;

            try {
                const response = await fetch(`${API_URL}/api/auth/change-password`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ currentPassword, newPassword })
                });

                const data = await response.json();

                if (response.ok) {
                    showProfileAlert('Contrase√±a actualizada exitosamente', 'success');
                    document.getElementById('changePasswordForm').reset();
                } else {
                    showProfileAlert(data.error || 'Error al cambiar contrase√±a', 'danger');
                }
            } catch (error) {
                showProfileAlert('Error de conexi√≥n', 'danger');
            }
        });

        function showProfileAlert(message, type) {
            const container = document.getElementById('profileAlertContainer');
            container.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            setTimeout(() => container.innerHTML = '', 3000);
        }

        // === UPLOADS ===
        
        // Preview de archivo
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const previewContainer = document.getElementById('previewContainer');
            const previewContent = document.getElementById('previewContent');
            
            previewContainer.style.display = 'block';
            
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewContent.innerHTML = `
                        <img src="${e.target.result}" class="img-fluid" style="max-height: 300px; border-radius: 8px;">
                        <p class="mt-2"><strong>${file.name}</strong> (${formatFileSize(file.size)})</p>
                    `;
                };
                reader.readAsDataURL(file);
            } else if (file.type.startsWith('video/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewContent.innerHTML = `
                        <video controls class="img-fluid" style="max-height: 300px; border-radius: 8px;">
                            <source src="${e.target.result}" type="${file.type}">
                        </video>
                        <p class="mt-2"><strong>${file.name}</strong> (${formatFileSize(file.size)})</p>
                    `;
                };
                reader.readAsDataURL(file);
            }
        });

        // Subir archivo CON contexto del avistamiento
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showUploadAlert('Por favor selecciona un archivo', 'danger');
                return;
            }

            // Verificar tama√±o (50MB)
            if (file.size > 50 * 1024 * 1024) {
                showUploadAlert('El archivo es demasiado grande. M√°ximo: 50MB', 'danger');
                return;
            }

            const token = localStorage.getItem('token');
            const formData = new FormData();
            formData.append('file', file);

            // NUEVO: Agregar contexto del avistamiento
            const sightingContext = {
                movement: document.getElementById('contextMovement').value,
                speedEstimate: parseInt(document.getElementById('contextSpeed').value),
                altitudeEstimate: document.getElementById('contextAltitude').value,
                lightColor: Array.from(document.getElementById('contextLightColor').selectedOptions).map(opt => opt.value),
                lightIntensity: document.getElementById('contextLightIntensity').value,
                soundHeard: document.getElementById('contextSound').value,
                duration: document.getElementById('contextDuration').value,
                weatherConditions: document.getElementById('contextWeather').value,
                witnessActivity: document.getElementById('contextActivity').value,
                substanceUse: document.querySelector('input[name="substanceUse"]:checked').value === 'true',
                beliefLevel: document.getElementById('contextBelief').value,
                accompanied: document.getElementById('contextAccompanied').value === 'true',
                witnessCount: document.getElementById('contextAccompanied').value === 'true' ? 
                    parseInt(document.getElementById('contextWitnessCount').value) || 1 : 1,
                emotionalState: document.getElementById('contextEmotional').value,
                previousSightings: document.getElementById('contextPreviousSightings').value === 'true',
                previousSightingsCount: document.getElementById('contextPreviousSightings').value === 'true' ? 
                    parseInt(document.getElementById('contextPreviousCount').value) || 0 : 0,
                incidentDescription: document.getElementById('contextDescription').value
            };

            formData.append('sightingContext', JSON.stringify(sightingContext));

            const uploadBtn = document.getElementById('uploadBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Subiendo...';
            progressContainer.style.display = 'block';

            try {
                const xhr = new XMLHttpRequest();

                // Progreso
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        progressBar.style.width = percentComplete + '%';
                        progressText.textContent = `Subiendo: ${Math.round(percentComplete)}%`;
                    }
                });

                // Completado
                xhr.addEventListener('load', () => {
                    if (xhr.status === 201) {
                        const data = JSON.parse(xhr.responseText);
                        showUploadAlert('¬°Archivo y contexto subidos exitosamente! El an√°lisis comenzar√° autom√°ticamente.', 'success');
                        
                        // Limpiar formulario
                        document.getElementById('uploadForm').reset();
                        document.getElementById('previewContainer').style.display = 'none';
                        progressContainer.style.display = 'none';
                        
                        // Resetear campos especiales
                        document.getElementById('contextWitnessCount').style.display = 'none';
                        document.getElementById('contextPreviousCount').style.display = 'none';
                        
                        // Recargar lista de uploads
                        loadUploads();
                    } else {
                        const error = JSON.parse(xhr.responseText);
                        showUploadAlert(error.error || 'Error al subir archivo', 'danger');
                    }
                    
                    uploadBtn.disabled = false;
                    uploadBtn.innerHTML = '<i class="bi bi-cloud-upload"></i> Subir y Analizar';
                });

                // Error
                xhr.addEventListener('error', () => {
                    showUploadAlert('Error de conexi√≥n', 'danger');
                    uploadBtn.disabled = false;
                    uploadBtn.innerHTML = '<i class="bi bi-cloud-upload"></i> Subir y Analizar';
                    progressContainer.style.display = 'none';
                });

                // Enviar
                xhr.open('POST', `${API_URL}/api/uploads`);
                xhr.setRequestHeader('Authorization', `Bearer ${token}`);
                xhr.send(formData);

            } catch (error) {
                console.error('Error:', error);
                showUploadAlert('Error al subir archivo', 'danger');
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i class="bi bi-cloud-upload"></i> Subir Archivo';
                progressContainer.style.display = 'none';
            }
        });

        // Cargar lista de uploads
        async function loadUploads() {
            const token = localStorage.getItem('token');
            const container = document.getElementById('uploadsListContainer');

            try {
                const response = await fetch(`${API_URL}/api/uploads`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (data.analyses.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted p-4">
                            <i class="bi bi-inbox" style="font-size: 48px;"></i>
                            <p class="mt-2">No has subido ning√∫n archivo a√∫n</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Archivo</th>
                                    <th>Tipo</th>
                                    <th>Tama√±o</th>
                                    <th>Estado</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="uploadsTableBody"></tbody>
                        </table>
                    </div>
                `;

                const tbody = document.getElementById('uploadsTableBody');
                data.analyses.forEach(analysis => {
                    const row = document.createElement('tr');
                    
                    const statusBadge = getStatusBadge(analysis.status);
                    const typeIcon = analysis.fileType === 'image' ? 'bi-image' : 'bi-camera-video';
                    
                    // Botones seg√∫n estado
                    let actionButtons = '';
                    
                    if (analysis.status === 'pending' && analysis.fileType === 'image') {
                        actionButtons = `
                            <button class="btn btn-sm btn-primary" onclick="analyzeImage('${analysis.id}')" title="Analizar con IA">
                                <i class="bi bi-robot"></i>
                            </button>
                        `;
                    } else if (analysis.status === 'analyzing') {
                        actionButtons = `
                            <button class="btn btn-sm btn-secondary" disabled>
                                <span class="spinner-border spinner-border-sm"></span>
                            </button>
                        `;
                    } else if (analysis.status === 'completed') {
                        actionButtons = `
                            <button class="btn btn-sm btn-success" onclick="viewAnalysis('${analysis.id}')" title="Ver resultados">
                                <i class="bi bi-eye"></i>
                            </button>
                        `;
                    }
                    
                    actionButtons += `
                        <button class="btn btn-sm btn-danger ms-1" onclick="deleteUpload('${analysis.id}')" title="Eliminar">
                            <i class="bi bi-trash"></i>
                        </button>
                    `;
                    
                    row.innerHTML = `
                        <td><i class="bi ${typeIcon}"></i> ${analysis.fileName}</td>
                        <td><span class="badge bg-secondary">${analysis.fileType}</span></td>
                        <td>${formatFileSize(analysis.fileSize)}</td>
                        <td>${statusBadge}</td>
                        <td>${new Date(analysis.uploadDate).toLocaleString('es-ES')}</td>
                        <td class="text-nowrap">${actionButtons}</td>
                    `;
                    tbody.appendChild(row);
                });

            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = `
                    <div class="alert alert-danger">
                        Error al cargar uploads
                    </div>
                `;
            }
        }

        // Eliminar upload
        async function deleteUpload(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este archivo?')) return;

            const token = localStorage.getItem('token');

            try {
                const response = await fetch(`${API_URL}/api/uploads/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    showUploadAlert('Archivo eliminado exitosamente', 'success');
                    loadUploads();
                } else {
                    const data = await response.json();
                    showUploadAlert(data.error || 'Error al eliminar', 'danger');
                }
            } catch (error) {
                showUploadAlert('Error de conexi√≥n', 'danger');
            }
        }

        // Analizar imagen con IA
        async function analyzeImage(id) {
            const token = localStorage.getItem('token');

            try {
                const response = await fetch(`${API_URL}/api/analyze/${id}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    showUploadAlert('An√°lisis iniciado. Actualizando...', 'info');
                    loadUploads();
                    // Iniciar polling del estado
                    pollAnalysisStatus(id);
                } else {
                    const data = await response.json();
                    showUploadAlert(data.error || 'Error al iniciar an√°lisis', 'danger');
                }
            } catch (error) {
                showUploadAlert('Error de conexi√≥n', 'danger');
            }
        }

        // Polling del estado de an√°lisis
        let pollingIntervals = {};
        async function pollAnalysisStatus(id) {
            // Evitar m√∫ltiples polling del mismo id
            if (pollingIntervals[id]) return;

            const token = localStorage.getItem('token');
            
            pollingIntervals[id] = setInterval(async () => {
                try {
                    const response = await fetch(`${API_URL}/api/analyze/${id}/status`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.status === 'completed' || data.status === 'error') {
                            clearInterval(pollingIntervals[id]);
                            delete pollingIntervals[id];
                            loadUploads();
                            
                            if (data.status === 'completed') {
                                showUploadAlert('¬°An√°lisis completado!', 'success');
                            } else {
                                showUploadAlert('Error en el an√°lisis', 'danger');
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error polling status:', error);
                }
            }, 2000); // Poll cada 2 segundos
        }

        // Ver resultados de an√°lisis
        async function viewAnalysis(id) {
            const token = localStorage.getItem('token');

            try {
                console.log('üîç Solicitando an√°lisis:', id);
                const response = await fetch(`${API_URL}/api/analyze/${id}/status`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ Datos recibidos:', data);
                    console.log('  - fileName:', data.fileName);
                    console.log('  - uploadDate:', data.uploadDate);
                    console.log('  - hasExifData:', data.hasExifData);
                    console.log('  - hasAiAnalysis:', data.hasAiAnalysis);
                    // Guardar el ID del an√°lisis
                    data.analysisId = id;
                    displayAnalysisResults(data);
                } else {
                    const error = await response.json();
                    console.error('‚ùå Error del servidor:', error);
                    showUploadAlert(error.error || 'Error al cargar resultados', 'danger');
                }
            } catch (error) {
                console.error('‚ùå Error de conexi√≥n:', error);
                showUploadAlert('Error de conexi√≥n', 'danger');
            }
        }

        // Mostrar resultados en modal
        function displayAnalysisResults(data) {
            const modalHtml = `
                <div class="modal fade" id="analysisModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-robot"></i> Resultados del An√°lisis
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ${generateAnalysisContent(data)}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" onclick="openReportForm('${data.analysisId || data._id}')" data-bs-dismiss="modal">
                                    <i class="bi bi-file-earmark-text"></i> Generar Reporte PDF
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Eliminar modal previo si existe
            const existingModal = document.getElementById('analysisModal');
            if (existingModal) {
                existingModal.remove();
            }

            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('analysisModal'));
            modal.show();
        }

        function generateAnalysisContent(data) {
            let html = '<div class="container-fluid">';

            // Informaci√≥n del archivo
            html += `
                <div class="row mb-4">
                    <div class="col-12">
                        <h6 class="border-bottom pb-2"><i class="bi bi-file-earmark"></i> Archivo</h6>
                        <p><strong>Nombre:</strong> ${data.fileName || 'N/A'}</p>
                        <p><strong>Fecha de subida:</strong> ${data.uploadDate ? new Date(data.uploadDate).toLocaleString('es-ES') : 'N/A'}</p>
                    </div>
                </div>
            `;

            // Datos EXIF
            if (data.hasExifData && data.analysisData?.exifData) {
                html += generateExifSection(data.analysisData.exifData);
            }

            // An√°lisis IA
            if (data.hasAiAnalysis && data.analysisData?.aiAnalysis) {
                html += generateAiSection(data.analysisData.aiAnalysis);
            }

            // Coincidencias
            if (data.hasMatches && data.analysisData?.matchResults?.length > 0) {
                html += generateMatchesSection(data.analysisData.matchResults);
            }

            // Si no hay an√°lisis
            if (!data.hasExifData && !data.hasAiAnalysis) {
                html += '<div class="alert alert-warning">No hay datos de an√°lisis disponibles.</div>';
            }

            html += '</div>';
            return html;
        }

        function generateExifSection(exifData) {
            let html = `
                <div class="row mb-4">
                    <div class="col-12">
                        <h6 class="border-bottom pb-2 mb-3">
                            <i class="bi bi-camera"></i> Datos T√©cnicos de Captura (EXIF) 
                            <small class="text-muted">- An√°lisis forense de metadatos</small>
                        </h6>
            `;

            // ===== INDICADORES DE MANIPULACI√ìN (PRIMERO - M√ÅS IMPORTANTE) =====
            if (exifData.isManipulated !== undefined || exifData.manipulationScore !== undefined) {
                const score = 100 - (exifData.manipulationScore || 0);
                const isManipulated = exifData.isManipulated || exifData.manipulationScore > 50;
                const scoreColor = score >= 70 ? 'success' : score >= 40 ? 'warning' : 'danger';
                
                html += `
                    <div class="alert ${isManipulated ? 'alert-warning' : 'alert-success'} mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="alert-heading mb-2">
                                    ${isManipulated ? '‚ö†Ô∏è POSIBLE MANIPULACI√ìN DETECTADA' : '‚úÖ SIN INDICIOS DE MANIPULACI√ìN'}
                                </h6>
                                <strong>Puntuaci√≥n de Autenticidad:</strong>
                            </div>
                            <div class="h2 mb-0">
                                <span class="badge bg-${scoreColor}">${score}/100</span>
                            </div>
                        </div>
                        <div class="progress mt-2" style="height: 20px;">
                            <div class="progress-bar bg-${scoreColor}" style="width: ${score}%">${score}%</div>
                        </div>
                        ${exifData.manipulationDetails ? 
                            `<div class="mt-2"><small><strong>Detalles:</strong> ${exifData.manipulationDetails}</small></div>` 
                            : ''}
                        ${exifData.isAIGenerated ? 
                            '<div class="mt-2 text-danger"><strong>‚ö†Ô∏è ADVERTENCIA: Imagen posiblemente generada por IA</strong></div>' 
                            : ''}
                    </div>
                `;
            }

            // ===== INFORMACI√ìN DE LA C√ÅMARA Y LENTE =====
            if (exifData.camera || exifData.cameraModel || exifData.lens || exifData.lensMake) {
                html += `
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="card-title"><i class="bi bi-camera2"></i> Equipo de Captura</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    ${exifData.camera || exifData.cameraModel ? `
                                        <p class="mb-1">
                                            <strong>C√°mara:</strong> 
                                            ${exifData.camera || ''} ${exifData.cameraModel || 'N/A'}
                                        </p>
                                    ` : ''}
                                    ${exifData.cameraSerialNumber ? `
                                        <p class="mb-1"><small class="text-muted">S/N: ${exifData.cameraSerialNumber}</small></p>
                                    ` : ''}
                                    ${exifData.firmware ? `
                                        <p class="mb-1"><small class="text-muted">Firmware: ${exifData.firmware}</small></p>
                                    ` : ''}
                                </div>
                                <div class="col-md-6">
                                    ${exifData.lens || exifData.lensMake ? `
                                        <p class="mb-1">
                                            <strong>Lente:</strong> 
                                            ${exifData.lensMake || ''} ${exifData.lens || 'N/A'}
                                        </p>
                                    ` : ''}
                                    ${exifData.lensSerialNumber ? `
                                        <p class="mb-1"><small class="text-muted">S/N: ${exifData.lensSerialNumber}</small></p>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // ===== CONFIGURACI√ìN DE CAPTURA (TRI√ÅNGULO DE EXPOSICI√ìN) =====
            if (exifData.iso || exifData.aperture || exifData.shutterSpeed || exifData.focalLength) {
                html += `
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="card-title"><i class="bi bi-gear"></i> Tri√°ngulo de Exposici√≥n y Configuraci√≥n</h6>
                            <div class="row">
                                <div class="col-md-3">
                                    ${exifData.iso ? `
                                        <div class="text-center p-2 border rounded">
                                            <div class="text-muted small">ISO</div>
                                            <div class="h5 mb-0">${exifData.iso}</div>
                                            <div class="small text-muted">
                                                ${exifData.iso > 1600 ? 'üåô Poca luz' : exifData.iso < 400 ? '‚òÄÔ∏è Buena luz' : '‚òÅÔ∏è Normal'}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="col-md-3">
                                    ${exifData.aperture ? `
                                        <div class="text-center p-2 border rounded">
                                            <div class="text-muted small">Apertura</div>
                                            <div class="h5 mb-0">${exifData.aperture}</div>
                                            <div class="small text-muted">
                                                ${parseFloat(exifData.aperture.replace('f/', '')) < 2.8 ? 'Muy abierta' : 'Normal'}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="col-md-3">
                                    ${exifData.shutterSpeed ? `
                                        <div class="text-center p-2 border rounded">
                                            <div class="text-muted small">Obturador</div>
                                            <div class="h5 mb-0">${exifData.shutterSpeed}</div>
                                            <div class="small text-muted">
                                                ${exifData.shutterSpeed.includes('s') && !exifData.shutterSpeed.includes('/') ? '‚è±Ô∏è Larga exp.' : '‚ö° R√°pido'}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="col-md-3">
                                    ${exifData.focalLength ? `
                                        <div class="text-center p-2 border rounded">
                                            <div class="text-muted small">Focal</div>
                                            <div class="h5 mb-0">${exifData.focalLength}</div>
                                            <div class="small text-muted">
                                                ${parseInt(exifData.focalLength) > 100 ? 'üî≠ Tele' : parseInt(exifData.focalLength) < 35 ? 'üìê Angular' : 'üì∑ Normal'}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <!-- Configuraci√≥n adicional -->
                            <div class="row mt-3">
                                ${exifData.exposureMode || exifData.exposureProgram || exifData.meteringMode ? `
                                    <div class="col-md-12">
                                        <div class="bg-white p-2 rounded">
                                            ${exifData.exposureMode ? `<small><strong>Modo:</strong> ${exifData.exposureMode} | </small>` : ''}
                                            ${exifData.exposureProgram ? `<small><strong>Programa:</strong> ${exifData.exposureProgram} | </small>` : ''}
                                            ${exifData.meteringMode ? `<small><strong>Medici√≥n:</strong> ${exifData.meteringMode}</small>` : ''}
                                        </div>
                                    </div>
                                ` : ''}
                                ${exifData.exposureBias ? `
                                    <div class="col-md-6 mt-2">
                                        <small><strong>Compensaci√≥n EV:</strong> ${exifData.exposureBias > 0 ? '+' : ''}${exifData.exposureBias}</small>
                                    </div>
                                ` : ''}
                                ${exifData.focalLengthIn35mm ? `
                                    <div class="col-md-6 mt-2">
                                        <small><strong>Focal equiv. 35mm:</strong> ${exifData.focalLengthIn35mm}mm</small>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <!-- Flash -->
                            ${exifData.flash !== undefined || exifData.flashMode ? `
                                <div class="mt-2 pt-2 border-top">
                                    <small>
                                        <i class="bi bi-lightning"></i> 
                                        <strong>Flash:</strong> 
                                        ${exifData.flashFired ? '‚úÖ Disparado' : '‚ùå No usado'}
                                        ${exifData.flashMode ? ` (${exifData.flashMode})` : ''}
                                    </small>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            // ===== ENFOQUE Y AJUSTES DE IMAGEN =====
            if (exifData.focusMode || exifData.whiteBalance || exifData.colorSpace || exifData.saturation || exifData.sharpness || exifData.contrast) {
                html += `
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="card-title"><i class="bi bi-sliders"></i> Ajustes de Imagen</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    ${exifData.focusMode ? `<p class="mb-1"><strong>Enfoque:</strong> ${exifData.focusMode}</p>` : ''}
                                    ${exifData.focusDistance ? `<p class="mb-1"><small>Distancia: ${exifData.focusDistance}m</small></p>` : ''}
                                    ${exifData.whiteBalance ? `<p class="mb-1"><strong>Balance de blancos:</strong> ${exifData.whiteBalance}</p>` : ''}
                                    ${exifData.colorSpace ? `<p class="mb-1"><strong>Espacio de color:</strong> ${exifData.colorSpace}</p>` : ''}
                                </div>
                                <div class="col-md-6">
                                    ${exifData.saturation ? `<p class="mb-1"><strong>Saturaci√≥n:</strong> ${exifData.saturation}</p>` : ''}
                                    ${exifData.sharpness ? `<p class="mb-1"><strong>Nitidez:</strong> ${exifData.sharpness}</p>` : ''}
                                    ${exifData.contrast ? `<p class="mb-1"><strong>Contraste:</strong> ${exifData.contrast}</p>` : ''}
                                    ${exifData.lightSource ? `<p class="mb-1"><strong>Fuente de luz:</strong> ${exifData.lightSource}</p>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // ===== FECHA Y HORA (M√öLTIPLES TIMESTAMPS) =====
            if (exifData.captureDate || exifData.dateTime || exifData.dateTimeDigitized) {
                const captureDate = exifData.captureDate ? new Date(exifData.captureDate) : null;
                const modifyDate = exifData.dateTime ? new Date(exifData.dateTime) : null;
                
                let timeOfDay = '';
                if (captureDate) {
                    const hour = captureDate.getHours();
                    if (hour >= 6 && hour < 12) timeOfDay = 'üåÖ Amanecer';
                    else if (hour >= 12 && hour < 18) timeOfDay = '‚òÄÔ∏è D√≠a';
                    else if (hour >= 18 && hour < 21) timeOfDay = 'üåá Atardecer';
                    else timeOfDay = 'üåô Noche';
                }
                
                html += `
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="card-title"><i class="bi bi-calendar-event"></i> Fecha y Hora</h6>
                            ${captureDate ? `
                                <p class="mb-1">
                                    <strong>üì∏ Captura original:</strong> 
                                    ${captureDate.toLocaleString('es-ES', { dateStyle: 'full', timeStyle: 'medium' })}
                                    <span class="badge bg-info ms-2">${timeOfDay}</span>
                                </p>
                            ` : ''}
                            ${modifyDate && modifyDate.getTime() !== captureDate?.getTime() ? `
                                <p class="mb-1 text-warning">
                                    <strong>‚ö†Ô∏è √öltima modificaci√≥n:</strong> 
                                    ${modifyDate.toLocaleString('es-ES', { dateStyle: 'full', timeStyle: 'medium' })}
                                </p>
                                <small class="text-muted">
                                    La fecha de modificaci√≥n difiere de la captura original (posible edici√≥n)
                                </small>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            // ===== UBICACI√ìN GPS =====
            if (exifData.location) {
                html += `
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="card-title"><i class="bi bi-geo-alt-fill"></i> Ubicaci√≥n GPS</h6>
                            <p class="mb-2">
                                <strong>Coordenadas:</strong> 
                                ${exifData.location.latitude?.toFixed(6) || 'N/A'}${exifData.location.latitudeRef || ''}, 
                                ${exifData.location.longitude?.toFixed(6) || 'N/A'}${exifData.location.longitudeRef || ''}
                                ${exifData.location.altitude ? `
                                    <br><strong>Altitud:</strong> ${exifData.location.altitude} m ${exifData.location.altitudeRef || 'sobre nivel del mar'}
                                ` : ''}
                                ${exifData.location.gpsDateStamp ? `
                                    <br><small class="text-muted">Timestamp GPS: ${exifData.location.gpsDateStamp} ${exifData.location.gpsTimeStamp || ''}</small>
                                ` : ''}
                            </p>
                            ${exifData.location.latitude ? `
                                <a href="https://www.google.com/maps?q=${exifData.location.latitude},${exifData.location.longitude}" 
                                   target="_blank" 
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-map"></i> Ver en Google Maps
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            // ===== DIMENSIONES Y CALIDAD =====
            if (exifData.imageWidth || exifData.imageHeight || exifData.quality || exifData.fileSize) {
                const megapixels = (exifData.imageWidth && exifData.imageHeight) 
                    ? ((exifData.imageWidth * exifData.imageHeight) / 1000000).toFixed(1) 
                    : null;
                const fileSizeMB = exifData.fileSize ? (exifData.fileSize / 1024 / 1024).toFixed(2) : null;
                
                html += `
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="card-title"><i class="bi bi-image"></i> Dimensiones y Calidad</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    ${exifData.imageWidth && exifData.imageHeight ? `
                                        <p class="mb-1"><strong>Resoluci√≥n:</strong> ${exifData.imageWidth} √ó ${exifData.imageHeight} px</p>
                                        ${megapixels ? `<p class="mb-1"><small>${megapixels} megap√≠xeles</small></p>` : ''}
                                    ` : ''}
                                    ${exifData.xResolution && exifData.yResolution ? `
                                        <p class="mb-1"><small>DPI: ${exifData.xResolution} √ó ${exifData.yResolution} ${exifData.resolutionUnit || ''}</small></p>
                                    ` : ''}
                                </div>
                                <div class="col-md-6">
                                    ${exifData.quality ? `<p class="mb-1"><strong>Calidad:</strong> ${exifData.quality}</p>` : ''}
                                    ${exifData.compression ? `<p class="mb-1"><strong>Compresi√≥n:</strong> ${exifData.compression}</p>` : ''}
                                    ${fileSizeMB ? `<p class="mb-1"><strong>Tama√±o:</strong> ${fileSizeMB} MB</p>` : ''}
                                    ${exifData.fileType ? `<p class="mb-1"><strong>Tipo:</strong> ${exifData.fileType}</p>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // ===== SOFTWARE Y PROCESAMIENTO =====
            if (exifData.software || exifData.processingSoftware || exifData.artist || exifData.copyright) {
                html += `
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="card-title"><i class="bi bi-cpu"></i> Software y Metadata</h6>
                            ${exifData.software ? `
                                <p class="mb-1">
                                    <strong>Software:</strong> ${exifData.software}
                                    ${exifData.software.toLowerCase().includes('photoshop') || 
                                      exifData.software.toLowerCase().includes('gimp') || 
                                      exifData.software.toLowerCase().includes('lightroom') ? 
                                        ' <span class="badge bg-warning">‚ö†Ô∏è Editada</span>' : ''}
                                </p>
                            ` : ''}
                            ${exifData.processingSoftware ? `
                                <p class="mb-1 text-warning">
                                    <strong>‚ö†Ô∏è Procesada con:</strong> ${exifData.processingSoftware}
                                </p>
                            ` : ''}
                            ${exifData.artist ? `<p class="mb-1"><strong>Autor:</strong> ${exifData.artist}</p>` : ''}
                            ${exifData.copyright ? `<p class="mb-1"><strong>Copyright:</strong> ${exifData.copyright}</p>` : ''}
                            ${exifData.imageDescription ? `<p class="mb-1"><small><strong>Descripci√≥n:</strong> ${exifData.imageDescription}</small></p>` : ''}
                        </div>
                    </div>
                `;
            }

            // ===== DATOS RAW (EXPANDIBLE) =====
            if (exifData.rawTags && Object.keys(exifData.rawTags).length > 0) {
                html += `
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="bi bi-code-square"></i> Datos EXIF Completos 
                                <button class="btn btn-sm btn-outline-secondary float-end" 
                                        onclick="toggleRawExif()"
                                        id="toggleRawExifBtn">
                                    <i class="bi bi-eye"></i> Mostrar
                                </button>
                            </h6>
                            <div id="rawExifData" style="display: none;">
                                <pre class="bg-dark text-light p-3 rounded mt-2" style="max-height: 400px; overflow-y: auto; font-size: 0.85em;">${JSON.stringify(exifData.rawTags, null, 2)}</pre>
                            </div>
                        </div>
                    </div>
                `;
            }

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        // Funci√≥n para mostrar/ocultar datos RAW
        function toggleRawExif() {
            const element = document.getElementById('rawExifData');
            const btn = document.getElementById('toggleRawExifBtn');
            if (element.style.display === 'none') {
                element.style.display = 'block';
                btn.innerHTML = '<i class="bi bi-eye-slash"></i> Ocultar';
            } else {
                element.style.display = 'none';
                btn.innerHTML = '<i class="bi bi-eye"></i> Mostrar';
            }
        }

        function generateAiSection(aiAnalysis) {
            let html = `
                <div class="row mb-4">
                    <div class="col-12">
                        <h6 class="border-bottom pb-2"><i class="bi bi-robot"></i> An√°lisis de IA (${aiAnalysis.provider || 'Claude'})</h6>
            `;

            // NUEVO: Indicador de mejora con entrenamiento
            if (aiAnalysis.enhancedWithTraining && aiAnalysis.trainingData) {
                const trainingData = aiAnalysis.trainingData;
                html += `
                    <div class="alert alert-info mb-3">
                        <h6 class="alert-heading">
                            <i class="bi bi-mortarboard-fill"></i> An√°lisis Mejorado con Datos de Entrenamiento
                        </h6>
                        <p class="mb-1">
                            <strong>Este an√°lisis fue mejorado</strong> usando ${trainingData.matchCount} imagen(es) de referencia de la base de datos de entrenamiento.
                        </p>
                        ${trainingData.bestMatch ? `
                            <div class="mt-2 p-2 bg-light rounded">
                                <strong>Mejor coincidencia:</strong> ${trainingData.bestMatch.type}
                                <br><small class="text-muted">
                                    Similitud: ${trainingData.bestMatch.confidence}% | 
                                    Categor√≠a: ${trainingData.bestMatch.category}
                                </small>
                                ${trainingData.bestMatch.technicalData && trainingData.bestMatch.technicalData.manufacturer ? `
                                    <br><small><strong>Fabricante:</strong> ${trainingData.bestMatch.technicalData.manufacturer}</small>
                                ` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            if (aiAnalysis.description) {
                html += `<p class="lead">${aiAnalysis.description}</p>`;
            }

            // Categor√≠a y confianza
            if (aiAnalysis.category) {
                const categoryBadge = getCategoryBadge(aiAnalysis.category);
                html += `<p><strong>Categor√≠a:</strong> ${categoryBadge}</p>`;
            }

            if (aiAnalysis.confidence !== undefined) {
                const confidenceColor = aiAnalysis.confidence >= 70 ? 'success' : aiAnalysis.confidence >= 40 ? 'warning' : 'danger';
                html += `
                    <div class="mb-3">
                        <strong>Nivel de confianza:</strong>
                        <div class="progress mt-2" style="height: 25px;">
                            <div class="progress-bar bg-${confidenceColor}" style="width: ${aiAnalysis.confidence}%">
                                ${aiAnalysis.confidence}%
                            </div>
                        </div>
                    </div>
                `;
            }

            // Objetos detectados
            if (aiAnalysis.detectedObjects?.length > 0) {
                html += `
                    <div class="mb-3">
                        <h6>Objetos Detectados</h6>
                        <ul class="list-group">
                            ${aiAnalysis.detectedObjects.map(obj => `
                                <li class="list-group-item">
                                    <strong>${obj.object}</strong>
                                    ${obj.confidence ? ` - Confianza: ${obj.confidence}%` : ''}
                                    ${obj.description ? `<br><small class="text-muted">${obj.description}</small>` : ''}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            // Caracter√≠sticas inusuales
            if (aiAnalysis.isUnusual) {
                html += `
                    <div class="alert alert-info">
                        <i class="bi bi-exclamation-triangle"></i> <strong>Caracter√≠sticas inusuales detectadas</strong>
                        ${aiAnalysis.unusualFeatures ? '<p class="mb-0 mt-2">' + aiAnalysis.unusualFeatures + '</p>' : ''}
                    </div>
                `;
            }

            // Recomendaciones
            if (aiAnalysis.recommendations?.length > 0) {
                html += `
                    <div class="mb-3">
                        <h6>Recomendaciones</h6>
                        <ul>
                            ${aiAnalysis.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        function generateMatchesSection(matches) {
            let html = `
                <div class="row mb-4">
                    <div class="col-12">
                        <h6 class="border-bottom pb-2"><i class="bi bi-search"></i> Coincidencias con Base de Datos</h6>
                        <ul class="list-group">
                            ${matches.map(match => `
                                <li class="list-group-item">
                                    <strong>${match.objectName}</strong> - Similitud: ${match.similarity}%
                                    ${match.category ? `<br><small>Categor√≠a: ${match.category}</small>` : ''}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;

            return html;
        }

        function getCategoryBadge(category) {
            const badges = {
                'aircraft': '<span class="badge bg-primary">Aeronave</span>',
                'bird': '<span class="badge bg-success">Ave</span>',
                'drone': '<span class="badge bg-info">Drone</span>',
                'celestial': '<span class="badge bg-warning">Objeto Celestial</span>',
                'balloon': '<span class="badge bg-secondary">Globo</span>',
                'natural': '<span class="badge bg-success">Fen√≥meno Natural</span>',
                'hoax': '<span class="badge bg-danger">Posible Fraude</span>',
                'uap': '<span class="badge bg-dark">UAP/OVNI</span>',
                'unknown': '<span class="badge bg-secondary">Desconocido</span>'
            };

            return badges[category.toLowerCase()] || `<span class="badge bg-secondary">${category}</span>`;
        }

        // Funciones auxiliares
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        }

        function getStatusBadge(status) {
            const badges = {
                'pending': '<span class="badge bg-secondary">Pendiente</span>',
                'uploading': '<span class="badge bg-info">Subiendo</span>',
                'analyzing': '<span class="badge bg-warning">Analizando</span>',
                'completed': '<span class="badge bg-success">Completado</span>',
                'error': '<span class="badge bg-danger">Error</span>'
            };
            return badges[status] || badges['pending'];
        }

        // ========== FUNCIONES AUXILIARES FORMULARIO CONTEXTO ==========

        // Actualizar valor de velocidad
        document.getElementById('contextSpeed').addEventListener('input', (e) => {
            const value = e.target.value;
            const labels = ['Muy lento', 'Lento', 'Normal', 'R√°pido', 'Muy r√°pido'];
            document.getElementById('speedValue').textContent = labels[value - 1];
        });

        // Toggle n√∫mero de testigos
        function toggleWitnessCount() {
            const accompanied = document.getElementById('contextAccompanied').value === 'true';
            const witnessCountInput = document.getElementById('contextWitnessCount');
            witnessCountInput.style.display = accompanied ? 'block' : 'none';
            if (accompanied) {
                witnessCountInput.value = 2;
            }
        }

        // Toggle avistamientos previos
        function togglePreviousCount() {
            const hasPrevious = document.getElementById('contextPreviousSightings').value === 'true';
            const previousCountInput = document.getElementById('contextPreviousCount');
            previousCountInput.style.display = hasPrevious ? 'block' : 'none';
            if (hasPrevious) {
                previousCountInput.value = 1;
            }
        }

        function showUploadAlert(message, type) {
            const container = document.getElementById('uploadAlertContainer');
            container.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            setTimeout(() => container.innerHTML = '', 3000);
        }

        // Cargar uploads al mostrar la secci√≥n
        document.querySelector('a[onclick*="uploads"]').addEventListener('click', () => {
            loadUploads();
        });

        // Cargar reportes al mostrar la secci√≥n
        document.querySelector('a[onclick*="reports"]').addEventListener('click', () => {
            loadReports();
        });

        // ========== FUNCIONES DE REPORTES ==========

        async function loadReports() {
            const token = localStorage.getItem('token');
            const container = document.getElementById('reportsListContainer');

            try {
                // Obtener filtros
                const category = document.getElementById('filterCategory').value;
                const status = document.getElementById('filterStatus').value;
                const search = document.getElementById('searchReports').value;

                // Construir query params
                let queryParams = '?limit=100';
                if (status) queryParams += `&status=${status}`;
                if (category) queryParams += `&category=${category}`;

                const response = await fetch(`${API_URL}/api/uploads${queryParams}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                // Filtrar por b√∫squeda local
                let analyses = data.analyses || [];
                if (search) {
                    analyses = analyses.filter(a => 
                        a.fileName.toLowerCase().includes(search.toLowerCase())
                    );
                }

                // Actualizar estad√≠sticas
                updateReportStats(analyses);

                // Mostrar lista
                if (analyses.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted p-4">
                            <i class="bi bi-inbox" style="font-size: 48px;"></i>
                            <p class="mt-2">No se encontraron reportes</p>
                        </div>
                    `;
                    return;
                }

                // Generar lista de reportes
                container.innerHTML = analyses.map(analysis => generateReportCard(analysis)).join('');

            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = `
                    <div class="alert alert-danger">
                        Error al cargar reportes
                    </div>
                `;
            }
        }

        function generateReportCard(analysis) {
            const statusBadge = getStatusBadge(analysis.status);
            const categoryBadge = analysis.bestMatch?.category ? 
                getCategoryBadge(analysis.bestMatch.category) : 
                '<span class="badge bg-secondary">Sin categor√≠a</span>';
            
            const confidence = analysis.aiAnalysis?.confidence || analysis.bestMatch?.matchPercentage || 0;
            const date = new Date(analysis.uploadDate).toLocaleString('es-ES');
            
            return `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h5 class="mb-2">
                                    <i class="bi bi-image"></i> ${analysis.fileName}
                                </h5>
                                <div class="mb-2">
                                    ${statusBadge} ${categoryBadge}
                                </div>
                                <small class="text-muted">
                                    <i class="bi bi-calendar"></i> ${date}
                                </small>
                            </div>
                            <div class="col-md-3 text-center">
                                ${analysis.status === 'completed' ? `
                                    <div class="mb-2">
                                        <strong>Confianza</strong>
                                    </div>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar ${getConfidenceColor(confidence)}" 
                                             style="width: ${confidence}%">
                                            ${confidence}%
                                        </div>
                                    </div>
                                ` : '<span class="text-muted">‚Äî</span>'}
                            </div>
                            <div class="col-md-3 text-end">
                                ${analysis.status === 'completed' ? `
                                    <button class="btn btn-sm btn-success" onclick="viewAnalysis('${analysis.id}')" title="Ver an√°lisis">
                                        <i class="bi bi-eye"></i> Ver Detalles
                                    </button>
                                ` : ''}
                                ${analysis.status === 'pending' ? `
                                    <button class="btn btn-sm btn-primary" onclick="analyzeImage('${analysis.id}')" title="Analizar">
                                        <i class="bi bi-robot"></i> Analizar
                                    </button>
                                ` : ''}
                                <button class="btn btn-sm btn-danger ms-1" onclick="deleteUpload('${analysis.id}')" title="Eliminar">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        ${analysis.status === 'completed' && analysis.aiAnalysis?.description ? `
                            <div class="mt-3 pt-3 border-top">
                                <small class="text-muted">
                                    <i class="bi bi-info-circle"></i> ${analysis.aiAnalysis.description.substring(0, 150)}...
                                </small>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function updateReportStats(analyses) {
            document.getElementById('totalReports').textContent = analyses.length;
            
            const completed = analyses.filter(a => a.status === 'completed').length;
            document.getElementById('completedReports').textContent = completed;
            
            const uaps = analyses.filter(a => 
                a.bestMatch?.category === 'uap' || 
                a.aiAnalysis?.category === 'uap'
            ).length;
            document.getElementById('uapReports').textContent = uaps;
            
            const confidences = analyses
                .filter(a => a.status === 'completed')
                .map(a => a.aiAnalysis?.confidence || a.bestMatch?.matchPercentage || 0);
            
            const avgConf = confidences.length > 0 
                ? Math.round(confidences.reduce((a, b) => a + b, 0) / confidences.length)
                : 0;
            
            document.getElementById('avgConfidence').textContent = avgConf + '%';
        }

        function getConfidenceColor(confidence) {
            if (confidence >= 70) return 'bg-success';
            if (confidence >= 40) return 'bg-warning';
            return 'bg-danger';
        }

        function clearFilters() {
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('searchReports').value = '';
            loadReports();
        }

        // ==================== FUNCIONES DE REPORTES ====================
        
        // Abrir formulario de reporte
        function openReportForm(analysisId) {
            const modalHtml = `
                <div class="modal fade" id="reportModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">
                                    <i class="bi bi-file-earmark-text"></i> Generar Informe UAP
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="reportForm">
                                    <input type="hidden" id="reportAnalysisId" value="${analysisId}">
                                    
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle"></i>
                                        Complete los siguientes campos para generar un informe profesional en PDF del avistamiento.
                                    </div>

                                    <!-- Descripci√≥n del fen√≥meno -->
                                    <div class="mb-3">
                                        <label class="form-label">
                                            <strong>Descripci√≥n del fen√≥meno observado *</strong>
                                        </label>
                                        <textarea 
                                            class="form-control" 
                                            id="reportSituation" 
                                            rows="4" 
                                            required
                                            placeholder="Describa detalladamente lo que observ√≥..."
                                        ></textarea>
                                        <small class="text-muted">M√°ximo 2000 caracteres</small>
                                    </div>

                                    <!-- Ubicaci√≥n -->
                                    <div class="row mb-3">
                                        <div class="col-md-8">
                                            <label class="form-label"><strong>Ubicaci√≥n del avistamiento *</strong></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                id="reportLocation" 
                                                required
                                                placeholder="Ej: Madrid, Espa√±a o coordenadas GPS"
                                            >
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label"><strong>Fecha y Hora *</strong></label>
                                            <input 
                                                type="datetime-local" 
                                                class="form-control" 
                                                id="reportDatetime" 
                                                required
                                            >
                                        </div>
                                    </div>

                                    <!-- Testigos y duraci√≥n -->
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label"><strong>N√∫mero de testigos</strong></label>
                                            <input 
                                                type="number" 
                                                class="form-control" 
                                                id="reportWitnesses" 
                                                min="1" 
                                                value="1"
                                            >
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label"><strong>Duraci√≥n aproximada</strong></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                id="reportDuration" 
                                                placeholder="Ej: 5 minutos, 30 segundos"
                                            >
                                        </div>
                                    </div>

                                    <!-- Condiciones -->
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label"><strong>Condiciones clim√°ticas</strong></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                id="reportWeather" 
                                                placeholder="Ej: Despejado, Nublado"
                                            >
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label"><strong>Visibilidad</strong></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                id="reportVisibility" 
                                                placeholder="Ej: Buena, Excelente"
                                            >
                                        </div>
                                    </div>

                                    <!-- Notas adicionales -->
                                    <div class="mb-3">
                                        <label class="form-label"><strong>Notas adicionales</strong></label>
                                        <textarea 
                                            class="form-control" 
                                            id="reportNotes" 
                                            rows="3"
                                            placeholder="Cualquier informaci√≥n adicional relevante..."
                                        ></textarea>
                                    </div>

                                    <!-- Informaci√≥n de contacto (opcional) -->
                                    <div class="mb-3">
                                        <label class="form-label"><strong>Informaci√≥n de contacto (opcional)</strong></label>
                                        <input 
                                            type="text" 
                                            class="form-control" 
                                            id="reportContact" 
                                            placeholder="Nombre y email para seguimiento"
                                        >
                                    </div>

                                    <div id="reportFormMsg" class="mt-2"></div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-primary" onclick="submitReport()">
                                    <i class="bi bi-file-pdf"></i> Generar PDF
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Eliminar modal previo
            const existingModal = document.getElementById('reportModal');
            if (existingModal) {
                existingModal.remove();
            }

            // Agregar y mostrar modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = new bootstrap.Modal(document.getElementById('reportModal'));
            modal.show();

            // Establecer fecha actual por defecto
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('reportDatetime').value = now.toISOString().slice(0, 16);
        }

        // Enviar formulario de reporte
        async function submitReport() {
            const token = localStorage.getItem('token');
            const msgDiv = document.getElementById('reportFormMsg');

            try {
                // Obtener datos del formulario
                const analysisId = document.getElementById('reportAnalysisId').value;
                const situation = document.getElementById('reportSituation').value;
                const location = document.getElementById('reportLocation').value;
                const datetime = document.getElementById('reportDatetime').value;
                const witnesses = document.getElementById('reportWitnesses').value;
                const duration = document.getElementById('reportDuration').value;
                const weatherConditions = document.getElementById('reportWeather').value;
                const visibility = document.getElementById('reportVisibility').value;
                const additionalNotes = document.getElementById('reportNotes').value;
                const contactInfo = document.getElementById('reportContact').value;

                // Validar campos requeridos
                if (!situation || !location || !datetime) {
                    msgDiv.innerHTML = '<div class="alert alert-warning">Por favor, complete todos los campos requeridos (*)</div>';
                    return;
                }

                msgDiv.innerHTML = '<div class="alert alert-info">Creando reporte...</div>';

                // Paso 1: Crear reporte (borrador)
                const createResponse = await fetch(`${API_URL}/api/reports`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        analysisId,
                        situation,
                        location,
                        datetime,
                        witnesses: parseInt(witnesses) || 1,
                        duration,
                        weatherConditions,
                        visibility,
                        additionalNotes,
                        contactInfo
                    })
                });

                if (!createResponse.ok) {
                    const error = await createResponse.json();
                    throw new Error(error.error || 'Error al crear reporte');
                }

                const { report: createdReport } = await createResponse.json();
                msgDiv.innerHTML = '<div class="alert alert-info">Generando PDF...</div>';

                // Paso 2: Generar PDF
                const generateResponse = await fetch(`${API_URL}/api/reports/${createdReport._id}/generate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!generateResponse.ok) {
                    const error = await generateResponse.json();
                    throw new Error(error.error || 'Error al generar PDF');
                }

                const { downloadUrl, report: generatedReport } = await generateResponse.json();

                msgDiv.innerHTML = '<div class="alert alert-success">¬°PDF generado exitosamente! Descargando...</div>';

                // Descargar PDF con autenticaci√≥n
                setTimeout(async () => {
                    try {
                        // Fetch del PDF con token
                        const pdfResponse = await fetch(`${API_URL}${downloadUrl}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (!pdfResponse.ok) {
                            throw new Error('Error al descargar PDF');
                        }

                        // Convertir respuesta a blob
                        const blob = await pdfResponse.blob();
                        
                        // Crear URL temporal del blob
                        const url = window.URL.createObjectURL(blob);
                        
                        // Crear enlace temporal y hacer clic
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = generatedReport.pdfFileName || `UAP-Report-${generatedReport.reportNumber}.pdf`;
                        document.body.appendChild(a);
                        a.click();
                        
                        // Limpiar
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);

                        // Cerrar modal
                        const modal = bootstrap.Modal.getInstance(document.getElementById('reportModal'));
                        modal.hide();

                        // Mostrar notificaci√≥n
                        showUploadAlert('Reporte generado y descargado exitosamente.', 'success');
                        
                    } catch (downloadError) {
                        console.error('Error al descargar PDF:', downloadError);
                        showUploadAlert('PDF generado pero hubo un error al descargarlo. Intenta descargarlo desde "Mis Reportes".', 'warning');
                    }
                }, 1000);

            } catch (error) {
                console.error('Error al generar reporte:', error);
                msgDiv.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }

        // ==================== FIN FUNCIONES REPORTES ====================

        // ==================== NOTIFICACIONES ====================
        
        // Cargar contador de notificaciones no le√≠das
        async function loadNotificationCount() {
            const token = localStorage.getItem('token');
            if (!token) return;

            try {
                const response = await fetch(`${API_URL}/api/notifications/unread/count`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const badge = document.getElementById('notificationBadge');
                    
                    if (data.count > 0) {
                        badge.textContent = data.count > 99 ? '99+' : data.count;
                        badge.style.display = 'inline-block';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Error al cargar notificaciones:', error);
            }
        }

        // Actualizar notificaciones cada 30 segundos
        setInterval(loadNotificationCount, 30000);

        // ==================== FIN NOTIFICACIONES ====================

        // ==================== TRAINING DATA MANAGEMENT ====================
        
        let trainingCurrentPage = 1;
        const trainingPageSize = 10;

        // Preview de imagen antes de subir
        document.getElementById('trainingImage')?.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('trainingPreviewImg').src = event.target.result;
                    document.getElementById('trainingPreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Subir imagen de entrenamiento
        document.getElementById('trainingUploadForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();

            const token = localStorage.getItem('token');
            const msgDiv = document.getElementById('trainingUploadMsg');
            const submitBtn = e.target.querySelector('button[type="submit"]');

            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Subiendo...';

                const formData = new FormData();
                formData.append('image', document.getElementById('trainingImage').files[0]);
                formData.append('category', document.getElementById('trainingCategory').value);
                formData.append('type', document.getElementById('trainingType').value);
                formData.append('description', document.getElementById('trainingDescription').value);

                const response = await fetch(`${API_URL}/api/training`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    msgDiv.innerHTML = `<div class="alert alert-success">
                        <i class="bi bi-check-circle"></i> ${data.message || 'Imagen subida exitosamente'}
                    </div>`;
                    
                    // Limpiar formulario
                    document.getElementById('trainingUploadForm').reset();
                    document.getElementById('trainingPreview').style.display = 'none';
                    
                    // Recargar lista y stats
                    loadTrainingImages();
                    loadTrainingStats();
                } else {
                    msgDiv.innerHTML = `<div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> ${data.error || 'Error al subir imagen'}
                    </div>`;
                }
            } catch (error) {
                console.error('Error:', error);
                msgDiv.innerHTML = `<div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> Error de conexi√≥n: ${error.message}
                </div>`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="bi bi-upload"></i> Subir Imagen';
                
                // Limpiar mensaje despu√©s de 5 segundos
                setTimeout(() => {
                    msgDiv.innerHTML = '';
                }, 5000);
            }
        });

        // Cargar im√°genes de entrenamiento
        async function loadTrainingImages(page = 1) {
            const token = localStorage.getItem('token');
            const container = document.getElementById('trainingImagesContainer');

            try {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                `;

                const category = document.getElementById('trainingFilterCategory').value;
                const verified = document.getElementById('trainingFilterVerified').value;
                
                let url = `${API_URL}/api/training?page=${page}&limit=${trainingPageSize}`;
                if (category) url += `&category=${category}`;
                if (verified) url += `&verified=${verified}`;

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Error al cargar im√°genes');
                }

                const data = await response.json();

                if (data.images && data.images.length > 0) {
                    let html = '<div class="table-responsive"><table class="table table-hover">';
                    html += `
                        <thead>
                            <tr>
                                <th>Miniatura</th>
                                <th>Categor√≠a</th>
                                <th>Tipo</th>
                                <th>Descripci√≥n</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                    `;

                    data.images.forEach(img => {
                        const categoryNames = {
                            'aircraft_commercial': 'Avi√≥n Comercial',
                            'aircraft_military': 'Avi√≥n Militar',
                            'drone': 'Drone',
                            'helicopter': 'Helic√≥ptero',
                            'balloon': 'Globo',
                            'satellite': 'Sat√©lite',
                            'bird': 'Ave',
                            'natural': 'Fen√≥meno Natural',
                            'celestial': 'Celeste',
                            'lens_flare': 'Destello',
                            'weather': 'Meteorol√≥gico',
                            'unknown': 'Desconocido'
                        };

                        html += `
                            <tr>
                                <td>
                                    <img src="${img.fullImageUrl}" 
                                         class="img-thumbnail" 
                                         style="max-width: 80px; max-height: 80px; cursor: pointer;"
                                         onclick="viewTrainingImage('${img.fullImageUrl}', '${img.type}')"
                                         alt="${img.type}">
                                </td>
                                <td>
                                    <span class="badge bg-primary">${categoryNames[img.category] || img.category}</span>
                                </td>
                                <td><strong>${img.type}</strong></td>
                                <td class="small text-muted" style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                                    ${img.description || '-'}
                                </td>
                                <td>
                                    ${img.verified ? 
                                        '<span class="badge bg-success"><i class="bi bi-check-circle"></i> Verificada</span>' : 
                                        '<span class="badge bg-warning"><i class="bi bi-clock"></i> Pendiente</span>'
                                    }
                                    ${img.isActive ? '' : '<span class="badge bg-secondary">Inactiva</span>'}
                                </td>
                                <td class="small text-muted">
                                    ${new Date(img.createdAt).toLocaleDateString('es-ES')}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="deleteTrainingImage('${img._id}')" 
                                            title="Eliminar">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    });

                    html += '</tbody></table></div>';
                    container.innerHTML = html;

                    // Paginaci√≥n
                    renderTrainingPagination(data.pagination);
                } else {
                    container.innerHTML = `
                        <div class="alert alert-info text-center">
                            <i class="bi bi-info-circle"></i> No hay im√°genes de entrenamiento a√∫n.
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> Error al cargar im√°genes: ${error.message}
                    </div>
                `;
            }
        }

        // Renderizar paginaci√≥n
        function renderTrainingPagination(pagination) {
            const container = document.getElementById('trainingPagination');
            if (!pagination || pagination.totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = '<ul class="pagination justify-content-center">';
            
            // Bot√≥n anterior
            html += `
                <li class="page-item ${pagination.currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadTrainingImages(${pagination.currentPage - 1}); return false;">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                </li>
            `;

            // P√°ginas
            for (let i = 1; i <= pagination.totalPages; i++) {
                if (i === 1 || i === pagination.totalPages || (i >= pagination.currentPage - 2 && i <= pagination.currentPage + 2)) {
                    html += `
                        <li class="page-item ${i === pagination.currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="loadTrainingImages(${i}); return false;">${i}</a>
                        </li>
                    `;
                } else if (i === pagination.currentPage - 3 || i === pagination.currentPage + 3) {
                    html += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }

            // Bot√≥n siguiente
            html += `
                <li class="page-item ${pagination.currentPage === pagination.totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadTrainingImages(${pagination.currentPage + 1}); return false;">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
            `;

            html += '</ul>';
            container.innerHTML = html;
        }

        // Ver imagen en modal
        function viewTrainingImage(url, title) {
            const modalHtml = `
                <div class="modal fade" id="imageViewModal" tabindex="-1">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body text-center">
                                <img src="${url}" class="img-fluid" alt="${title}">
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const existingModal = document.getElementById('imageViewModal');
            if (existingModal) existingModal.remove();

            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = new bootstrap.Modal(document.getElementById('imageViewModal'));
            modal.show();
        }

        // Eliminar imagen de entrenamiento
        async function deleteTrainingImage(id) {
            if (!confirm('¬øEst√°s seguro de que deseas eliminar esta imagen de entrenamiento?')) {
                return;
            }

            const token = localStorage.getItem('token');

            try {
                const response = await fetch(`${API_URL}/api/training/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Imagen eliminada exitosamente');
                    loadTrainingImages();
                    loadTrainingStats();
                } else {
                    alert('Error: ' + (data.error || 'No se pudo eliminar la imagen'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error de conexi√≥n: ' + error.message);
            }
        }

        // Cargar estad√≠sticas de training
        async function loadTrainingStats() {
            const token = localStorage.getItem('token');

            try {
                const response = await fetch(`${API_URL}/api/training?limit=1`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('trainingStatsTotal').textContent = data.pagination?.totalItems || 0;
                    
                    // Calcular verificadas
                    const verifiedCount = data.images?.filter(img => img.verified).length || 0;
                    document.getElementById('trainingStatsVerified').textContent = verifiedCount;
                    
                    // Obtener categor√≠as √∫nicas
                    const categories = new Set(data.images?.map(img => img.category) || []);
                    document.getElementById('trainingStatsCategories').textContent = categories.size;
                }
            } catch (error) {
                console.error('Error cargando stats:', error);
            }
        }

        // ==================== FIN TRAINING DATA ====================

        // Inicializar
        checkAuth();
        loadNotificationCount();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
