<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico UAP Integration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-passed { color: green; font-weight: bold; }
        .test-failed { color: red; font-weight: bold; }
        .test-pending { color: orange; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="mb-4">üî¨ Diagn√≥stico UAP Integration</h1>
        
        <div class="card mb-3">
            <div class="card-header">
                <h3>Estado de Conexiones</h3>
            </div>
            <div class="card-body">
                <div id="diagnostics"></div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3>Datos de la API</h3>
            </div>
            <div class="card-body">
                <div id="api-data"></div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        const API_URL = 'http://localhost:3000/api';
        const diagnostics = $('#diagnostics');
        const apiData = $('#api-data');
        
        function addTest(name, status, details = '') {
            const statusClass = status === 'pass' ? 'test-passed' : status === 'fail' ? 'test-failed' : 'test-pending';
            const statusText = status === 'pass' ? '‚úì PASS' : status === 'fail' ? '‚úó FAIL' : '‚è≥ TESTING';
            diagnostics.append(`
                <div class="mb-2">
                    <span class="${statusClass}">${statusText}</span> - ${name}
                    ${details ? `<br><small class="text-muted">${details}</small>` : ''}
                </div>
            `);
        }
        
        // Test 1: Servidor Node.js
        addTest('Conectando al servidor Node.js...', 'pending');
        
        $.ajax({
            url: API_URL + '/categories',
            method: 'GET',
            timeout: 5000,
            success: function(response) {
                const categories = response.data || response;
                diagnostics.empty();
                addTest('Servidor Node.js', 'pass', `${categories.length} categor√≠as encontradas`);
                
                // Test 2: Biblioteca - Objetos
                $.get(API_URL + '/library/objects', function(objResponse) {
                    const objects = objResponse.data || objResponse;
                    addTest('Endpoint /library/objects', 'pass', `${objects.length} objetos encontrados`);
                    
                    if (objects.length > 0) {
                        apiData.append(`<h5>Ejemplo de Objeto:</h5><pre>${JSON.stringify(objects[0], null, 2)}</pre>`);
                    }
                }).fail(function() {
                    addTest('Endpoint /library/objects', 'fail', 'No se pudo conectar');
                });
                
                // Test 3: Biblioteca - Fen√≥menos
                $.get(API_URL + '/library/phenomena', function(phenResponse) {
                    const phenomena = phenResponse.data || phenResponse;
                    addTest('Endpoint /library/phenomena', 'pass', `${phenomena.length} fen√≥menos encontrados`);
                    
                    if (phenomena.length > 0) {
                        apiData.append(`<h5>Ejemplo de Fen√≥meno:</h5><pre>${JSON.stringify(phenomena[0], null, 2)}</pre>`);
                    }
                }).fail(function() {
                    addTest('Endpoint /library/phenomena', 'fail', 'No se pudo conectar');
                });
                
                // Test 4: An√°lisis
                $.get(API_URL + '/analysis', function(analysisResponse) {
                    const analyses = analysisResponse.data || analysisResponse;
                    addTest('Endpoint /analysis', 'pass', `${analyses.length} an√°lisis encontrados`);
                }).fail(function() {
                    addTest('Endpoint /analysis', 'fail', 'No se pudo conectar (esto es normal si no hay an√°lisis a√∫n)');
                });
                
                // Mostrar categor√≠as
                apiData.append(`<h5>Categor√≠as Disponibles:</h5>`);
                categories.forEach(cat => {
                    apiData.append(`<div class="badge bg-primary me-2 mb-2">${cat.icon} ${cat.name} (${cat.slug})</div>`);
                });
                
            },
            error: function(xhr, status, error) {
                diagnostics.empty();
                addTest('Servidor Node.js', 'fail', `Error: ${error}. Verifica que el servidor est√© corriendo en puerto 3000`);
            }
        });
    </script>
</body>
</html>
